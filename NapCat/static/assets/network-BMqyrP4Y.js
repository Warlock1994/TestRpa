import{j as e,h as N}from"./codemirror-core-vkcnXJgD.js";import{b as k,k as K,z as Q,A as X,v as Y,x as ee,y as te,B as ae,P as se}from"./index-DUXV0WOB.js";import{t as re,a as le}from"./chunk-ML27DD5T-D1RdkIPp.js";import{u as ne,c as q,J as j}from"./react-dom-Cz0lLOn1.js";import{a as oe}from"./index-j3cnden5.js";import{d as ie,a as ce,b as de,m as P}from"./chunk-KQ5CH2X7-C9iKrlN1.js";import{t as F}from"./chunk-6LIX6LVT-RWsS4VS1.js";import{s as I}from"./index-BCo31U5i.js";import{v as ue}from"./index-B9v0kxJY.js";import{P as me,H as $,a as pe,W as be,b as he}from"./icons-D1JuxfCB.js";import{c as C}from"./chunk-NAV3ZXLI-DPbBQfAo.js";import{s as fe}from"./chunk-J6JGI6RM-B4SU0inc.js";import{G as xe}from"./iconBase-DqQMrcxU.js";import{f as ge}from"./index-CJT7zyU5.js";import{l as ve}from"./index-CZf4TRP1.js";import{a as we,c as ke}from"./chunk-5PILOUBS-DKq7N4P3.js";import{c as ye}from"./chunk-TE6SZS6W-BJLgUfXq.js";import{c as Se}from"./chunk-D5XJWRAV-Br2wJXLi.js";import{u as U}from"./use-config-DKd6Xu8i.js";import{u as B}from"./use-dialog-D7Y1pqBM.js";import{i as je}from"./chunk-2QAN2V2R-Ckf_3FbK.js";import{s as Ce,l as Ne}from"./chunk-KVDW62ZT-Bm1t8H6j.js";import{u as Pe,C as Te}from"./react-hook-form-CmdhCKo7.js";import{S as De}from"./switch_card-BIRei_Bc.js";import"./chunk-UX7UMZL5-7aEsUCpo.js";import"./index-CokAva9Y.js";import"./Item-CdZrGEbe.js";import"./chunk-2QQAR2RD-D5YTDHxF.js";import"./chunk-WQVQ7P2I-DnA4mjrx.js";import"./chunk-FGM523TA-BJSiCD_V.js";import"./chunk-M3MASYO7-Cm5fw87L.js";import"./chunk-EN4B57RQ-DnfPgIbT.js";import"./qq_manager-BFsZvaN8.js";import"./chunk-SLABUSGS-DYDfi-dm.js";import"./chunk-AXSF7SRE-C5Cxy5n6.js";const Ee=a=>{const{onOpen:n}=a;return e.jsxs(ie,{classNames:{content:"bg-opacity-30 backdrop-blur-md"},placement:"right",children:[e.jsx(ce,{children:e.jsx(k,{className:"bg-default-100/50 hover:bg-default-200/50 text-default-700 backdrop-blur-md",startContent:e.jsx(ue,{className:"text-2xl"}),children:"新建"})}),e.jsxs(de,{"aria-label":"Create Network Config",color:"default",variant:"flat",onAction:o=>{n(o)},children:[e.jsx(P,{isReadOnly:!0,className:"cursor-default hover:!bg-transparent",textValue:"title",children:e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsx("div",{className:"w-5 h-5 -ml-3",children:e.jsx(me,{})}),e.jsx("div",{className:"text-primary-400",children:"新建网络配置"})]})},"title"),e.jsx(P,{textValue:"httpServers",startContent:e.jsx("div",{className:"w-6 h-6",children:e.jsx($,{})}),children:e.jsxs("div",{className:"flex gap-1 items-center",children:["HTTP服务器",e.jsx(F,{content:"「由NapCat建立」一个HTTP服务器，你可以「使用框架连接」此服务器或者「自己构造请求发送」至此服务器。NapCat会根据你配置的IP和端口等建立一个地址，你或者你的框架应该连接到这个地址。",showArrow:!0,className:"max-w-64",children:e.jsx(k,{isIconOnly:!0,radius:"full",size:"sm",variant:"light",className:"w-4 h-4 min-w-0",children:e.jsx(I,{})})})]})},"httpServers"),e.jsx(P,{textValue:"httpSseServers",startContent:e.jsx("div",{className:"w-6 h-6",children:e.jsx($,{})}),children:e.jsxs("div",{className:"flex gap-1 items-center",children:["HTTP SSE服务器",e.jsx(F,{content:"「由NapCat建立」一个HTTP SSE服务器，你可以「使用框架连接」此服务器或者「自己构造请求发送」至此服务器。NapCat会根据你配置的IP和端口等建立一个地址，你或者你的框架应该连接到这个地址。",showArrow:!0,className:"max-w-64",children:e.jsx(k,{isIconOnly:!0,radius:"full",size:"sm",variant:"light",className:"w-4 h-4 min-w-0",children:e.jsx(I,{})})})]})},"httpSseServers"),e.jsx(P,{textValue:"httpClients",startContent:e.jsx("div",{className:"w-6 h-6",children:e.jsx(pe,{})}),children:e.jsxs("div",{className:"flex gap-1 items-center",children:["HTTP客户端",e.jsx(F,{content:"「由框架或者你自己建立」的一个用于「接收」NapCat向你发送请求的客户端，通常框架会提供一个HTTP地址。这个地址是你使用的框架提供的，NapCat会主动连接它。",showArrow:!0,className:"max-w-64",children:e.jsx(k,{isIconOnly:!0,radius:"full",size:"sm",variant:"light",className:"w-4 h-4 min-w-0",children:e.jsx(I,{})})})]})},"httpClients"),e.jsx(P,{textValue:"websocketServers",startContent:e.jsx("div",{className:"w-6 h-6",children:e.jsx(be,{})}),children:e.jsxs("div",{className:"flex gap-1 items-center",children:["Websocket服务器",e.jsx(F,{content:"「由NapCat建立」一个WebSocket服务器，你的框架应该连接到此服务器。NapCat会根据你配置的IP和端口等建立一个WebSocket地址，你或者你的框架应该连接到这个地址。",showArrow:!0,className:"max-w-64",children:e.jsx(k,{isIconOnly:!0,radius:"full",size:"sm",variant:"light",className:"w-4 h-4 min-w-0",children:e.jsx(I,{})})})]})},"websocketServers"),e.jsx(P,{textValue:"websocketClients",startContent:e.jsx("div",{className:"w-6 h-6",children:e.jsx(he,{})}),children:e.jsxs("div",{className:"flex gap-1 items-center",children:["Websocket客户端",e.jsx(F,{content:"「由框架或者你自己建立」的WebSocket，通常框架会「提供」一个ws地址，NapCat会主动连接它。",showArrow:!0,className:"max-w-64",children:e.jsx(k,{isIconOnly:!0,radius:"full",size:"sm",variant:"light",className:"w-4 h-4 min-w-0",children:e.jsx(I,{})})})]})},"websocketClients")]})]})};function He(a){return xe({attr:{viewBox:"0 0 24 24",fill:"none"},child:[{tag:"path",attr:{d:"M10 11C10 10.4477 10.4477 10 11 10H13C13.5523 10 14 10.4477 14 11C14 11.5523 13.5523 12 13 12H11C10.4477 12 10 11.5523 10 11Z",fill:"currentColor"},child:[]},{tag:"path",attr:{d:"M11 14C10.4477 14 10 14.4477 10 15C10 15.5523 10.4477 16 11 16H13C13.5523 16 14 15.5523 14 15C14 14.4477 13.5523 14 13 14H11Z",fill:"currentColor"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M9.09447 4.74918C8.41606 4.03243 8 3.0648 8 2H10C10 3.10457 10.8954 4 12 4C13.1046 4 14 3.10457 14 2H16C16 3.0648 15.5839 4.03243 14.9055 4.74918C16.1782 5.45491 17.1673 6.6099 17.6586 8H19C19.5523 8 20 8.44772 20 9C20 9.55229 19.5523 10 19 10H18V12H19C19.5523 12 20 12.4477 20 13C20 13.5523 19.5523 14 19 14H18V16H19C19.5523 16 20 16.4477 20 17C20 17.5523 19.5523 18 19 18H17.6586C16.8349 20.3304 14.6124 22 12 22C9.38756 22 7.16508 20.3304 6.34141 18H5C4.44772 18 4 17.5523 4 17C4 16.4477 4.44772 16 5 16H6V14H5C4.44772 14 4 13.5523 4 13C4 12.4477 4.44772 12 5 12H6V10H5C4.44772 10 4 9.55229 4 9C4 8.44772 4.44772 8 5 8H6.34141C6.83274 6.6099 7.82181 5.45491 9.09447 4.74918ZM8 16V10C8 7.79086 9.79086 6 12 6C14.2091 6 16 7.79086 16 10V16C16 18.2091 14.2091 20 12 20C9.79086 20 8 18.2091 8 16Z",fill:"currentColor"},child:[]}]})(a)}const Re=({title:a,action:n,enableSwitch:o,children:i,className:c})=>{const[p]=ne(K.backgroundImage,""),b=!!p;return e.jsxs(we,{className:q("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm rounded-2xl overflow-hidden transition-all",b?"bg-white/20 dark:bg-black/10":"bg-white/60 dark:bg-black/40",c),children:[e.jsxs(Se,{className:"p-4 pb-2 flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0 mr-2",children:e.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-lg bg-default-100/50 dark:bg-white/10 border border-transparent dark:border-white/5",children:e.jsx("span",{className:"font-bold text-default-600 dark:text-white/90 text-sm truncate select-text",children:a})})}),e.jsx("div",{className:"flex-shrink-0",children:o})]}),e.jsx(ke,{className:"px-4 py-2 text-sm text-default-600",children:i}),e.jsx(ye,{className:"px-4 pb-4 pt-2",children:n})]})},z=({data:a,typeLabel:n,fields:o,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b,showType:h})=>{const{name:f,enable:u,debug:x}=a,[d,r]=N.useState(!1),s=()=>{r(!0),c().finally(()=>r(!1))},m=()=>{r(!0),p().finally(()=>r(!1))},g=()=>{r(!0),b().finally(()=>r(!1))},T=v=>["URL","Token","AccessToken"].includes(v);return e.jsx(Re,{className:"w-full max-w-[420px]",tag:h?n:void 0,action:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(k,{fullWidth:!0,radius:"full",size:"sm",variant:"flat",className:"flex-1 bg-default-100 dark:bg-default-50 text-default-600 font-medium hover:bg-warning/20 hover:text-warning transition-colors",startContent:e.jsx(ge,{size:16}),onPress:i,isDisabled:d,children:"编辑"}),e.jsx(k,{fullWidth:!0,radius:"full",size:"sm",variant:"flat",className:q("flex-1 bg-default-100 dark:bg-default-50 text-default-600 font-medium transition-colors",x?"hover:bg-secondary/20 hover:text-secondary data-[hover=true]:text-secondary":"hover:bg-success/20 hover:text-success data-[hover=true]:text-success"),startContent:e.jsx(He,{size:16}),onPress:g,isDisabled:d,children:x?"默认":"调试"}),e.jsx(k,{fullWidth:!0,radius:"full",size:"sm",variant:"flat",className:"flex-1 bg-default-100 dark:bg-default-50 text-default-600 font-medium hover:bg-danger/20 hover:text-danger transition-colors",startContent:e.jsx(ve,{size:16}),onPress:m,isDisabled:d,children:"删除"})]}),enableSwitch:e.jsx(fe,{isDisabled:d,isSelected:u,onChange:s,classNames:{wrapper:"group-data-[selected=true]:bg-primary-400"}}),title:f,children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:(()=>{const v=o.find(D=>T(D.label));if(v)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-1 p-3 bg-default-100/50 dark:bg-white/10 rounded-xl border border-transparent hover:border-default-200 transition-colors col-span-2",children:[e.jsx("span",{className:"text-xs text-default-500 dark:text-white/50 font-medium tracking-wide",children:"类型"}),e.jsx("div",{className:"text-sm font-medium text-default-700 dark:text-white/90 truncate",children:n})]}),e.jsxs("div",{className:"flex flex-col gap-1 p-3 bg-default-100/50 dark:bg-white/10 rounded-xl border border-transparent hover:border-default-200 transition-colors col-span-2",children:[e.jsx("span",{className:"text-xs text-default-500 dark:text-white/50 font-medium tracking-wide",children:v.label}),e.jsx("div",{className:"text-sm font-medium text-default-700 dark:text-white/90 truncate",children:v.render?v.render(v.value):e.jsx("span",{className:q(typeof v.value=="string"&&(v.value.startsWith("http")||v.value.includes(".")||v.value.includes(":"))?"font-mono":""),children:String(v.value)})})]})]});{const D=o.slice(0,3);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-1 p-3 bg-default-100/50 dark:bg-white/10 rounded-xl border border-transparent hover:border-default-200 transition-colors",children:[e.jsx("span",{className:"text-xs text-default-500 dark:text-white/50 font-medium tracking-wide",children:"类型"}),e.jsx("div",{className:"text-sm font-medium text-default-700 dark:text-white/90 truncate",children:n})]}),D.map((y,A)=>e.jsxs("div",{className:"flex flex-col gap-1 p-3 bg-default-100/50 dark:bg-white/10 rounded-xl border border-transparent hover:border-default-200 transition-colors",children:[e.jsx("span",{className:"text-xs text-default-500 dark:text-white/50 font-medium tracking-wide",children:y.label}),e.jsx("div",{className:"text-sm font-medium text-default-700 dark:text-white/90 truncate",children:y.render?y.render(y.value):e.jsx("span",{className:q(typeof y.value=="string"&&(y.value.startsWith("http")||y.value.includes(".")||y.value.includes(":"))?"font-mono":""),children:String(y.value)})})]},A))]})}})()})})},_e=a=>{const{data:n,showType:o,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b}=a,{url:h,reportSelfMessage:f,messagePostFormat:u}=n,x=[{label:"URL",value:h},{label:"消息格式",value:u},{label:"上报自身消息",value:f,render:d=>e.jsx(C,{color:d?"success":"default",size:"sm",variant:"flat",children:d?"是":"否"})}];return e.jsx(z,{data:n,showType:o,typeLabel:"HTTP客户端",fields:x,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b})},We=a=>{const{data:n,showType:o,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b}=a,{host:h,port:f,enableCors:u,enableWebsocket:x,messagePostFormat:d}=n,r=[{label:"主机",value:h},{label:"端口",value:f},{label:"消息格式",value:d},{label:"CORS",value:u,render:s=>e.jsx(C,{color:s?"success":"default",size:"sm",variant:"flat",children:s?"已启用":"未启用"})},{label:"WS",value:x,render:s=>e.jsx(C,{color:s?"success":"default",size:"sm",variant:"flat",children:s?"已启用":"未启用"})}];return e.jsx(z,{data:n,showType:o,typeLabel:"HTTP服务器",fields:r,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b})},Fe=a=>{const{data:n,showType:o,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b}=a,{host:h,port:f,enableCors:u,enableWebsocket:x,messagePostFormat:d}=n,r=[{label:"主机",value:h},{label:"端口",value:f},{label:"消息格式",value:d},{label:"CORS",value:u,render:s=>e.jsx(C,{color:s?"success":"default",size:"sm",variant:"flat",children:s?"已启用":"未启用"})},{label:"WS",value:x,render:s=>e.jsx(C,{color:s?"success":"default",size:"sm",variant:"flat",children:s?"已启用":"未启用"})}];return e.jsx(z,{data:n,showType:o,typeLabel:"HTTP服务器",fields:r,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b})},Ie=a=>{const{data:n,showType:o,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b}=a,{url:h,heartInterval:f,reconnectInterval:u,messagePostFormat:x,reportSelfMessage:d}=n,r=[{label:"URL",value:h},{label:"重连间隔",value:`${u}ms`},{label:"心跳间隔",value:`${f}ms`},{label:"消息格式",value:x},{label:"上报自身消息",value:d,render:s=>e.jsx(C,{color:s?"success":"default",size:"sm",variant:"flat",children:s?"是":"否"})}];return e.jsx(z,{data:n,showType:o,typeLabel:"Websocket客户端",fields:r,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b})},qe=a=>{const{data:n,showType:o,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b}=a,{host:h,port:f,heartInterval:u,messagePostFormat:x,reportSelfMessage:d,enableForcePushEvent:r}=n,s=[{label:"主机",value:h},{label:"端口",value:f},{label:"心跳间隔",value:`${u}ms`},{label:"消息格式",value:x},{label:"上报自身消息",value:d,render:m=>e.jsx(C,{color:m?"success":"default",size:"sm",variant:"flat",children:m?"是":"否"})},{label:"强制推送事件",value:r,render:m=>e.jsx(C,{color:m?"success":"default",size:"sm",variant:"flat",children:m?"是":"否"})}];return e.jsx(z,{data:n,showType:o,typeLabel:"Websocket服务器",fields:s,onEdit:i,onEnable:c,onDelete:p,onEnableDebug:b})},O=({data:a,defaultValues:n,onClose:o,onSubmit:i,fields:c})=>{const{control:p,handleSubmit:b,formState:h,setValue:f,reset:u}=Pe({defaultValues:n}),d=b(async r=>{await i(r),o()},r=>{var m;const s=Object.values(r);s.length>0&&j.error((m=s[0])==null?void 0:m.message)});return N.useEffect(()=>{if(a){const r=Object.keys(a);for(const s of r){const m=a[s];f(s,m)}}else u()},[a,u,f]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-2 gap-y-4 gap-x-2 w-full",children:c.map(r=>e.jsx("div",{className:r.colSpan===1?"col-span-1":"col-span-2",children:e.jsx(Te,{control:p,name:r.name,rules:r.isRequired?{required:`请填写${r.label}`}:void 0,render:({field:s})=>{var m;switch(r.type){case"input":return e.jsx(je,{value:s.value,onValueChange:g=>s.onChange(g),ref:s.ref,isRequired:r.isRequired,isDisabled:r.isDisabled,label:r.label,placeholder:r.placeholder,classNames:{inputWrapper:"bg-default-100/50 dark:bg-white/5 backdrop-blur-md border border-transparent hover:bg-default-200/50 dark:hover:bg-white/10 transition-all shadow-sm data-[hover=true]:border-default-300",input:"bg-transparent text-default-700 placeholder:text-default-400"}});case"select":return e.jsx(Ce,{...s,ref:s.ref,isRequired:r.isRequired,label:r.label,placeholder:r.placeholder,selectedKeys:[s.value],value:s.value.toString(),classNames:{trigger:"bg-default-100/50 dark:bg-white/5 backdrop-blur-md border border-transparent hover:bg-default-200/50 dark:hover:bg-white/10 transition-all shadow-sm data-[hover=true]:border-default-300",value:"text-default-700"},children:((m=r.options)==null?void 0:m.map(g=>e.jsx(Ne,{value:g.value,children:g.value},g.key)))||e.jsx(e.Fragment,{})});case"switch":return e.jsx(De,{...s,value:s.value,description:r.description,label:r.label});default:return e.jsx(e.Fragment,{})}}})},r.name))})}),e.jsxs(X,{children:[e.jsx(k,{color:"primary",isDisabled:h.isSubmitting,variant:"light",onPress:o,children:"关闭"}),e.jsx(k,{color:"primary",isLoading:h.isSubmitting,onPress:()=>d(),children:"保存"})]})]})};function M(a){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.~";let o="";for(let i=0;i<a;i++)o+=n.charAt(Math.floor(Math.random()*n.length));return o}const ze=({data:a,onClose:n,onSubmit:o})=>{const i={enable:!1,name:"",url:"http://localhost:8080",reportSelfMessage:!1,messagePostFormat:"array",token:M(16),debug:!1},c=[{name:"enable",label:"启用",type:"switch",description:"保存后启用此配置",colSpan:1},{name:"debug",label:"开启Debug",type:"switch",description:"是否开启调试模式",colSpan:1},{name:"name",label:"名称",type:"input",placeholder:"请输入名称",isRequired:!0,isDisabled:!!a},{name:"url",label:"URL",type:"input",placeholder:"请输入URL",isRequired:!0},{name:"reportSelfMessage",label:"上报自身消息",type:"switch",description:"是否上报自身消息",colSpan:1},{name:"messagePostFormat",label:"消息格式",type:"select",placeholder:"请选择消息格式",isRequired:!0,options:[{key:"array",value:"Array"},{key:"string",value:"String"}],colSpan:1},{name:"token",label:"Token",type:"input",placeholder:"请输入Token"}];return e.jsx(O,{data:a,defaultValues:i,onClose:n,onSubmit:o,fields:c})},Oe=({data:a,onClose:n,onSubmit:o})=>{const i={enable:!1,name:"",host:"127.0.0.1",port:3e3,enableCors:!0,enableWebsocket:!1,messagePostFormat:"array",token:M(16),debug:!1},c=[{name:"enable",label:"启用",type:"switch",description:"保存后启用此配置",colSpan:1},{name:"debug",label:"开启Debug",type:"switch",description:"是否开启调试模式",colSpan:1},{name:"name",label:"名称",type:"input",placeholder:"请输入名称",isRequired:!0,isDisabled:!!a},{name:"host",label:"Host",type:"input",placeholder:"请输入主机地址",isRequired:!0},{name:"port",label:"Port",type:"input",placeholder:"请输入端口",isRequired:!0},{name:"enableCors",label:"启用CORS",type:"switch",description:"是否启用CORS跨域",colSpan:1},{name:"enableWebsocket",label:"启用Websocket",type:"switch",description:"是否启用Websocket",colSpan:1},{name:"messagePostFormat",label:"消息格式",type:"select",placeholder:"请选择消息格式",isRequired:!0,options:[{key:"array",value:"Array"},{key:"string",value:"String"}]},{name:"token",label:"Token",type:"input",placeholder:"请输入Token"}];return e.jsx(O,{data:a,defaultValues:i,onClose:n,onSubmit:o,fields:c})},Me=({data:a,onClose:n,onSubmit:o})=>{const i={enable:!1,name:"",host:"127.0.0.1",port:3e3,enableCors:!0,enableWebsocket:!1,messagePostFormat:"array",token:M(16),debug:!1,reportSelfMessage:!1},c=[{name:"enable",label:"启用",type:"switch",description:"保存后启用此配置",colSpan:1},{name:"debug",label:"开启Debug",type:"switch",description:"是否开启调试模式",colSpan:1},{name:"name",label:"名称",type:"input",placeholder:"请输入名称",isRequired:!0,isDisabled:!!a},{name:"host",label:"Host",type:"input",placeholder:"请输入主机地址",isRequired:!0},{name:"port",label:"Port",type:"input",placeholder:"请输入端口",isRequired:!0},{name:"enableCors",label:"启用CORS",type:"switch",description:"是否启用CORS跨域",colSpan:1},{name:"enableWebsocket",label:"启用Websocket",type:"switch",description:"是否启用Websocket",colSpan:1},{name:"messagePostFormat",label:"消息格式",type:"select",placeholder:"请选择消息格式",isRequired:!0,options:[{key:"array",value:"Array"},{key:"string",value:"String"}]},{name:"token",label:"Token",type:"input",placeholder:"请输入Token"},{name:"reportSelfMessage",label:"上报自身消息",type:"switch",description:"是否上报自身消息",colSpan:1}];return e.jsx(O,{data:a,defaultValues:i,onClose:n,onSubmit:o,fields:c})},Ae=({data:a,onClose:n,onSubmit:o})=>{const i={enable:!1,name:"",url:"ws://localhost:8082",reportSelfMessage:!1,messagePostFormat:"array",token:M(16),debug:!1,heartInterval:3e4,reconnectInterval:3e4},c=[{name:"enable",label:"启用",type:"switch",description:"保存后启用此配置",colSpan:1},{name:"debug",label:"开启Debug",type:"switch",description:"是否开启调试模式",colSpan:1},{name:"name",label:"名称",type:"input",placeholder:"请输入名称",isRequired:!0,isDisabled:!!a},{name:"url",label:"URL",type:"input",placeholder:"请输入URL",isRequired:!0},{name:"reportSelfMessage",label:"上报自身消息",type:"switch",description:"是否上报自身消息",colSpan:1},{name:"messagePostFormat",label:"消息格式",type:"select",placeholder:"请选择消息格式",isRequired:!0,options:[{key:"array",value:"Array"},{key:"string",value:"String"}],colSpan:1},{name:"token",label:"Token",type:"input",placeholder:"请输入Token"},{name:"heartInterval",label:"心跳间隔",type:"input",placeholder:"请输入心跳间隔",isRequired:!0,colSpan:1},{name:"reconnectInterval",label:"重连间隔",type:"input",placeholder:"请输入重连间隔",isRequired:!0,colSpan:1}];return e.jsx(O,{data:a,defaultValues:i,onClose:n,onSubmit:o,fields:c})},Ve=({data:a,onClose:n,onSubmit:o})=>{const i={enable:!1,name:"",host:"127.0.0.1",port:3001,reportSelfMessage:!1,enableForcePushEvent:!0,messagePostFormat:"array",token:M(16),debug:!1,heartInterval:3e4},c=[{name:"enable",label:"启用",type:"switch",description:"保存后启用此配置",colSpan:1},{name:"debug",label:"开启Debug",type:"switch",description:"是否开启调试模式",colSpan:1},{name:"name",label:"名称",type:"input",placeholder:"请输入名称",isRequired:!0,isDisabled:!!a},{name:"host",label:"Host",type:"input",placeholder:"请输入主机地址",isRequired:!0},{name:"port",label:"Port",type:"input",placeholder:"请输入端口",isRequired:!0,colSpan:1},{name:"messagePostFormat",label:"消息格式",type:"select",placeholder:"请选择消息格式",isRequired:!0,options:[{key:"array",value:"Array"},{key:"string",value:"String"}],colSpan:1},{name:"reportSelfMessage",label:"上报自身消息",type:"switch",description:"是否上报自身消息",colSpan:1},{name:"enableForcePushEvent",label:"强制推送事件",type:"switch",description:"是否强制推送事件",colSpan:1},{name:"token",label:"Token",type:"input",placeholder:"请输入Token"},{name:"heartInterval",label:"心跳间隔",type:"input",placeholder:"请输入心跳间隔",isRequired:!0}];return e.jsx(O,{data:a,defaultValues:i,onClose:n,onSubmit:o,fields:c})},Le={httpServers:"HTTP Server",httpClients:"HTTP Client",httpSseServers:"HTTP SSE Server",websocketServers:"Websocket Server",websocketClients:"Websocket Client"},$e=a=>{const{isOpen:n,onOpenChange:o,field:i,data:c}=a,{createNetworkConfig:p,updateNetworkConfig:b}=U(),h=B(),f=!c,u=async d=>{const r=async s=>{try{f?await p(i,s):await b(i,s),j.success("保存配置成功")}catch(m){const g=m.message;throw j.error(`保存配置失败: ${g}`),m}};if(["httpServers","httpSseServers","websocketServers"].includes(i)){const s=d;if(!s.token&&s.host!=="127.0.0.1"){await new Promise((m,g)=>{h.confirm({title:"安全警告",content:e.jsxs("div",{children:[e.jsx("p",{children:"检测到未配置Token，这可能导致安全风险。确认要继续吗？"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"(未配置Token时，Host将被强制限制为 127.0.0.1)"})]}),onConfirm:async()=>{s.host="127.0.0.1";try{await r(s),m()}catch(T){g(T)}},onCancel:()=>{g(new Error("Cancelled"))}})});return}}await r(d)},x=d=>{switch(i){case"httpServers":return e.jsx(Oe,{data:c,onClose:d,onSubmit:u});case"httpClients":return e.jsx(ze,{data:c,onClose:d,onSubmit:u});case"websocketServers":return e.jsx(Ve,{data:c,onClose:d,onSubmit:u});case"websocketClients":return e.jsx(Ae,{data:c,onClose:d,onSubmit:u});case"httpSseServers":return e.jsx(Me,{data:c,onClose:d,onSubmit:u});default:return null}};return e.jsx(Y,{backdrop:"blur",isDismissable:!1,isOpen:n,size:"lg",scrollBehavior:"outside",onOpenChange:o,children:e.jsx(ee,{children:d=>e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"flex flex-col gap-1",children:Le[i]}),x(d)]})})})},Ue=({isEmpty:a})=>e.jsx("div",{className:q("text-default-400",{hidden:!a}),children:"暂时还没有配置项哈"});function Pt(){const{config:a,refreshConfig:n,deleteNetworkConfig:o,enableNetworkConfig:i,enableDebugNetworkConfig:c}=U(),[p,b]=N.useState("httpServers"),[h,f]=N.useState(""),{network:{httpServers:u,httpClients:x,httpSseServers:d,websocketServers:r,websocketClients:s}}=a,[m,g]=N.useState(!1),{isOpen:T,onOpen:v,onOpenChange:D}=ae(),y=B(),A=N.useMemo(()=>a.network[p].find(t=>t.name===h),[p,h,a]),V=async()=>{g(!0);try{await n(),g(!1)}catch(l){const t=l.message;j.error(`获取配置失败: ${t}`)}finally{g(!1)}},Z=l=>{b(l),f(""),v()},E=async(l,t)=>new Promise((w,W)=>{y.confirm({title:"删除配置",content:`确定要删除配置「${t}」吗?`,onConfirm:async()=>{try{await o(l,t),j.success("删除配置成功"),w()}catch(L){const J=L.message;j.error(`删除配置失败: ${J}`),W(L)}},onCancel:()=>{w()}})}),H=async(l,t)=>{try{await i(l,t),j.success("更新配置成功")}catch(w){const W=w.message;throw j.error(`更新配置失败: ${W}`),w}},R=async(l,t)=>{try{await c(l,t),j.success("更新配置成功")}catch(w){const W=w.message;throw j.error(`更新配置失败: ${W}`),w}},_=(l,t)=>{b(l),f(t),v()},S=(l,t,w=!1)=>{switch(l){case"httpServers":return e.jsx(We,{showType:w,data:t,onDelete:async()=>{await E("httpServers",t.name)},onEdit:()=>{_("httpServers",t.name)},onEnable:async()=>{await H("httpServers",t.name)},onEnableDebug:async()=>{await R("httpServers",t.name)}},t.name);case"httpClients":return e.jsx(_e,{showType:w,data:t,onDelete:async()=>{await E("httpClients",t.name)},onEdit:()=>{_("httpClients",t.name)},onEnable:async()=>{await H("httpClients",t.name)},onEnableDebug:async()=>{await R("httpClients",t.name)}},t.name);case"httpSseServers":return e.jsx(Fe,{showType:w,data:t,onDelete:async()=>{await E("httpSseServers",t.name)},onEdit:()=>{_("httpSseServers",t.name)},onEnable:async()=>{await H("httpSseServers",t.name)},onEnableDebug:async()=>{await R("httpSseServers",t.name)}},t.name);case"websocketServers":return e.jsx(qe,{showType:w,data:t,onDelete:async()=>{await E("websocketServers",t.name)},onEdit:()=>{_("websocketServers",t.name)},onEnable:async()=>{await H("websocketServers",t.name)},onEnableDebug:async()=>{await R("websocketServers",t.name)}},t.name);case"websocketClients":return e.jsx(Ie,{showType:w,data:t,onDelete:async()=>{await E("websocketClients",t.name)},onEdit:()=>{_("websocketClients",t.name)},onEnable:async()=>{await H("websocketClients",t.name)},onEnableDebug:async()=>{await R("websocketClients",t.name)}},t.name)}},G=[{key:"all",title:"全部",items:[...u,...x,...r,...s,...d].sort((l,t)=>l.name.localeCompare(t.name)).map(l=>u.find(t=>t.name===l.name)?S("httpServers",l,!0):d.find(t=>t.name===l.name)?S("httpSseServers",l,!0):x.find(t=>t.name===l.name)?S("httpClients",l,!0):r.find(t=>t.name===l.name)?S("websocketServers",l,!0):s.find(t=>t.name===l.name)?S("websocketClients",l,!0):null)},{key:"httpServers",title:"HTTP服务器",items:u.map(l=>S("httpServers",l))},{key:"httpClients",title:"HTTP客户端",items:x.map(l=>S("httpClients",l))},{key:"httpSseServers",title:"HTTP SSE服务器",items:d.map(l=>S("httpSseServers",l))},{key:"websocketServers",title:"Websocket服务器",items:r.map(l=>S("websocketServers",l))},{key:"websocketClients",title:"Websocket客户端",items:s.map(l=>S("websocketClients",l))}];return N.useEffect(()=>{V()},[]),e.jsxs(e.Fragment,{children:[e.jsx("title",{children:"网络配置 - NapCat WebUI"}),e.jsxs("div",{className:"p-2 md:p-4 relative",children:[e.jsx($e,{data:A,field:p,isOpen:T,onOpenChange:D}),e.jsx(se,{loading:m}),e.jsxs("div",{className:"flex mb-6 items-center gap-4",children:[e.jsx(Ee,{onOpen:Z}),e.jsx(k,{isIconOnly:!0,className:"bg-default-100/50 hover:bg-default-200/50 text-default-700 backdrop-blur-md",radius:"full",onPress:V,children:e.jsx(oe,{size:24})})]}),e.jsx(re,{"aria-label":"Network Configs",className:"max-w-full",items:G,classNames:{tabList:"bg-white/40 dark:bg-black/20 backdrop-blur-md",cursor:"bg-white/80 dark:bg-white/10 backdrop-blur-md shadow-sm"},children:l=>e.jsxs(le,{title:l.title,children:[e.jsx(Ue,{isEmpty:!l.items.length}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 justify-start items-stretch gap-x-2 gap-y-4",children:l.items})]},l.key)})]})]})}export{Pt as default};
