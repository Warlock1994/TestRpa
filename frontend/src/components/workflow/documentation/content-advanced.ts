export const advancedFeaturesContent = `# 🧠 高级功能

本章介绍流程控制、AI集成、API请求等高级功能。

---

## 🔀 流程控制

### 子流程（模块复用）

将常用的模块组合封装成可复用的子流程，实现模块化和代码复用。

**创建子流程（3步）**：

1. **拖入分组**：从左侧「流程控制」分类拖入「分组」模块到画布
2. **设为子流程**：选中分组，在右侧配置面板开启「设为子流程」开关
3. **命名子流程**：输入子流程名称（如"登录流程"）

分组会变成**绿色边框**，显示「📦 子流程定义」标识。

**在子流程内放置模块**：

1. 拖动分组边缘调整大小
2. 将需要复用的模块拖入分组内部
3. 在分组内部连接这些模块

**调用子流程**：

1. 从左侧「流程控制」分类拖入「调用子流程」模块
2. 在右侧配置面板的下拉列表中选择要调用的子流程
3. 将「调用子流程」模块连接到主流程中

**执行逻辑**：
- 子流程内的模块**不会被主流程直接执行**
- 只有执行到「调用子流程」模块时，才会执行对应分组内的所有模块
- 子流程可以**访问和修改主流程的变量**
- 同一个子流程可以在主流程中**多次调用**

**错误处理**：
- 子流程内的模块出错时，会先执行该模块的橙色错误分支（如果有）
- 然后触发「调用子流程」模块的橙色错误分支
- 子流程不会因为单个模块出错而强制结束

**使用场景**：
- 登录流程复用：多个任务都需要先登录
- 数据采集模板：相同的采集逻辑复用
- 通用操作封装：如翻页、滚动加载等

**示例**：
\`\`\`
画布布局：

┌─────────────────────────────────────┐
│  [子流程分组: 登录流程]              │
│    输入用户名 → 输入密码 → 点击登录   │
└─────────────────────────────────────┘

主流程：
  打开网页 → 调用子流程(登录) → 采集数据 → 导出
\`\`\`

**发布与分享**：
- 导出/发布时子流程自动包含
- 其他用户下载后可直接使用和修改子流程

---

### 定时执行

在指定时间或延迟后执行后续流程，用于创建定时任务。

**定时类型**：

#### 1. 指定时间执行

在设定的日期和时间执行。

| 参数 | 说明 | 示例 |
|------|------|------|
| 执行日期 | 目标日期 | 2024-12-31 |
| 执行时间 | 目标时间 | 09:00 |

**示例**：每天早上9点执行签到
\`\`\`
定时执行：
  类型：指定时间
  日期：2024-12-26
  时间：09:00
  
→ 等待到指定时间后继续执行后续模块
\`\`\`

#### 2. 延迟执行

等待指定时长后执行。

| 参数 | 说明 | 示例 |
|------|------|------|
| 延迟小时 | 等待的小时数 | 1 |
| 延迟分钟 | 等待的分钟数 | 30 |
| 延迟秒数 | 等待的秒数 | 0 |

**示例**：延迟5分钟后执行
\`\`\`
定时执行：
  类型：延迟执行
  延迟分钟：5
  
→ 等待5分钟后继续执行后续模块
\`\`\`

**使用场景**：
- 定时签到、打卡
- 延迟发送消息
- 等待特定时间执行任务
- 避开高峰期执行

**注意事项**：
- 定时执行模块不受超时限制
- 如果目标时间已过，会立即执行
- 工作流停止时会取消等待中的定时任务

---

### 条件判断

根据条件执行不同的分支，实现"如果...则...否则..."的逻辑。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 左值 | 条件左边的值 | \`{价格}\`、\`{状态}\` |
| 运算符 | 比较方式 | ==、!=、>、< 等 |
| 右值 | 条件右边的值 | \`100\`、\`"成功"\` |

**支持的运算符**：

| 运算符 | 说明 | 示例 | 结果 |
|--------|------|------|------|
| == | 等于 | \`{count} == 10\` | count等于10时为真 |
| != | 不等于 | \`{status} != "error"\` | status不是error时为真 |
| > | 大于 | \`{price} > 100\` | price大于100时为真 |
| < | 小于 | \`{age} < 18\` | age小于18时为真 |
| >= | 大于等于 | \`{score} >= 60\` | score大于等于60时为真 |
| <= | 小于等于 | \`{num} <= 0\` | num小于等于0时为真 |
| contains | 包含 | \`{text} contains "关键词"\` | text包含"关键词"时为真 |
| startsWith | 开头是 | \`{url} startsWith "https"\` | url以https开头时为真 |
| endsWith | 结尾是 | \`{file} endsWith ".jpg"\` | file以.jpg结尾时为真 |

**分支连接**：

条件判断模块有两个输出：
- **✓ 真**：条件成立时执行
- **✗ 假**：条件不成立时执行

**示例**：检查登录状态
\`\`\`
条件判断：{登录状态} == "已登录"
  ├─ 真 → 执行签到操作
  └─ 假 → 执行登录操作
\`\`\`

---

### 循环执行

重复执行一段流程。

**循环类型**：

#### 1. 计数循环

执行固定次数。

| 参数 | 说明 |
|------|------|
| 循环次数 | 要执行的次数 |
| 索引变量 | 循环索引的变量名（默认：loop_index） |

**自动创建的变量**：
- \`{loop_index}\`：当前是第几次（从0开始，可自定义名称）

**示例**：翻页采集10页数据
\`\`\`
循环执行 10 次
  ├─ 采集当前页数据
  ├─ 点击下一页
  └─ 等待页面加载

可以用 {loop_index} 知道当前是第几页（0-9）
\`\`\`

#### 2. 条件循环

满足条件时持续执行。

| 参数 | 说明 |
|------|------|
| 循环条件 | 继续循环的条件 |

**示例**：循环直到没有下一页
\`\`\`
条件循环：{有下一页} == true
  ├─ 采集当前页数据
  ├─ 检查是否有下一页
  ├─ 点击下一页
  └─ 等待页面加载
\`\`\`

---

### 遍历列表

对列表中的每个元素执行操作。

**配置项**：

| 参数 | 说明 |
|------|------|
| 数据源变量 | 要遍历的列表变量名（直接填变量名，不加花括号） |
| 循环变量 | 当前元素的变量名（默认：item） |
| 索引变量 | 当前索引的变量名（默认：index） |

**自动创建的变量**：
- \`{item}\`：当前正在处理的元素（可自定义名称）
- \`{index}\`：当前元素的索引（从0开始，可自定义名称）

**示例**：遍历URL列表采集数据
\`\`\`
设置变量：网址列表 = ["url1", "url2", "url3"]

遍历列表：网址列表（注意：直接填变量名，不加花括号）
  ├─ 打开网页：{item}
  ├─ 获取数据
  └─ 打印日志：正在处理第 {index} 个网址
\`\`\`

💡 **提示**：循环变量 \`item\`、\`index\` 会自动出现在变量智能提示中。

---

### 跳出循环 / 跳过当前循环

控制循环的执行流程。

**跳出循环（Break）**：
- 立即结束整个循环
- 跳到循环后面的模块继续执行

**跳过当前循环（Continue）**：
- 跳过本次循环的剩余部分
- 直接进入下一次循环

**示例**：找到目标后停止
\`\`\`
遍历列表：商品列表（直接填变量名）
  ├─ 条件判断：{item[price]} < 100
  │   ├─ 真 → 设置变量：找到的商品 = {item}
  │   │       跳出循环
  │   └─ 假 → 跳过当前循环
\`\`\`

---

## 🤖 AI大脑

调用AI大模型处理文本，让工作流更智能。

### 支持的模型

| 提供商 | 模型 | API地址 |
|--------|------|---------|
| OpenAI | gpt-3.5-turbo、gpt-4 | https://api.openai.com/v1 |
| 智谱AI | glm-4、glm-3-turbo | https://open.bigmodel.cn/api/paas/v4 |
| Deepseek | deepseek-chat | https://api.deepseek.com/v1 |
| 月之暗面 | moonshot-v1-8k | https://api.moonshot.cn/v1 |
| 其他 | 兼容OpenAI接口的模型 | 自定义 |

### 配置说明

| 参数 | 说明 | 示例 |
|------|------|------|
| API地址 | 模型接口地址 | https://api.openai.com/v1 |
| API密钥 | 你的API Key | sk-xxx... |
| 模型名称 | 要使用的模型 | gpt-3.5-turbo |
| 系统提示词 | 设定AI的角色和行为 | 你是一个数据分析专家 |
| 用户消息 | 发送给AI的内容 | 请分析以下数据：{数据} |
| 保存到变量 | 存储AI回复的变量名 | AI回复 |
| 温度 | 创造性程度（0-1） | 0.7 |

### 系统提示词技巧

**角色设定**：
\`\`\`
你是一个专业的商品评论分析师，擅长从评论中提取关键信息。
\`\`\`

**输出格式**：
\`\`\`
请以JSON格式输出，包含以下字段：
- sentiment: 情感（正面/负面/中性）
- keywords: 关键词列表
- summary: 一句话总结
\`\`\`

**限制条件**：
\`\`\`
请只输出JSON，不要有其他解释文字。
回答要简洁，不超过100字。
\`\`\`

### 实用场景

#### 1. 文章摘要
\`\`\`
系统提示词：你是一个文章摘要专家，请用3句话总结文章要点。
用户消息：{文章内容}
\`\`\`

#### 2. 情感分析
\`\`\`
系统提示词：分析以下评论的情感倾向，只回答：正面、负面或中性
用户消息：{评论内容}
\`\`\`

#### 3. 数据提取
\`\`\`
系统提示词：从文本中提取联系方式，以JSON格式输出：{"phone": "", "email": ""}
用户消息：{网页文本}
\`\`\`

#### 4. 内容生成
\`\`\`
系统提示词：你是一个营销文案专家
用户消息：请为以下商品写一段50字的推广文案：{商品信息}
\`\`\`

---

## 👁️ AI视觉

调用视觉理解模型分析图片内容。

### 支持的模型

| 提供商 | 模型 | 说明 |
|--------|------|------|
| 智谱AI | glm-4v-flash | 免费，推荐 |
| 智谱AI | glm-4v | 付费，更强 |
| OpenAI | gpt-4-vision-preview | 付费 |

### 图片来源

| 来源 | 说明 | 使用场景 |
|------|------|----------|
| 元素截图 | 截取指定元素的图片 | 验证码识别 |
| 页面截图 | 截取整个页面 | 页面分析 |
| 图片URL | 网络图片地址 | 分析在线图片 |
| 变量 | Base64编码或本地路径 | 使用之前保存的图片 |

### 配置说明

| 参数 | 说明 |
|------|------|
| API地址 | 视觉模型接口地址 |
| API密钥 | API Key |
| 模型名称 | 如 glm-4v-flash |
| 图片来源 | 选择图片获取方式 |
| 提示词 | 告诉AI要做什么 |
| 保存到变量 | 存储识别结果 |

### 实用场景

#### 1. 验证码识别
\`\`\`
图片来源：元素截图
选择器：#captcha-img
提示词：请识别图片中的验证码，只输出验证码字符，不要其他内容
\`\`\`

#### 2. 商品图片分析
\`\`\`
图片来源：图片URL
URL：{商品图片链接}
提示词：描述这个商品的外观特征，包括颜色、材质、风格
\`\`\`

#### 3. 图表数据提取
\`\`\`
图片来源：元素截图
选择器：.chart-container
提示词：提取图表中的数据，以JSON格式输出
\`\`\`

---

## 🧪 AI智能爬虫（实验性功能）

> ⚠️ **实验性功能提示**：AI智能爬虫和AI元素选择器是实验性功能，依赖第三方AI服务，可能存在不稳定性，不推荐在生产环境使用。

AI智能爬虫利用大语言模型的理解能力，通过自然语言描述即可从网页中提取数据，无需编写复杂的选择器。

### 🤖 AI智能爬虫

使用自然语言描述要提取的数据，AI会自动分析网页并提取相应内容。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| API密钥 | OpenAI兼容的API Key | sk-xxx... |
| 基础URL | API接口地址 | https://api.openai.com/v1 |
| 模型名称 | 使用的模型 | gpt-4o-mini |
| 提取指令 | 用自然语言描述要提取的内容 | 提取商品名称、价格和评分 |
| 输出格式 | JSON或Markdown | JSON |
| 保存到变量 | 存储提取结果的变量名 | 提取结果 |

**使用示例**：
\`\`\`
打开网页：https://example.com/product/123

AI智能爬虫：
  提取指令：提取商品名称、价格、库存数量、商品描述
  输出格式：JSON
  保存到变量：商品信息
  
打印日志：{商品信息}
\`\`\`

**输出结果示例**：
\`\`\`json
{
  "商品名称": "无线蓝牙耳机",
  "价格": "299元",
  "库存数量": "1000+",
  "商品描述": "高品质音质，长续航..."
}
\`\`\`

### 🎯 AI元素选择器

使用自然语言描述要定位的元素，AI会自动生成CSS选择器。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| API密钥 | OpenAI兼容的API Key | sk-xxx... |
| 基础URL | API接口地址 | https://api.openai.com/v1 |
| 模型名称 | 使用的模型 | gpt-4o-mini |
| 页面URL | 要分析的网页地址 | https://example.com |
| 页面加载等待 | 等待页面加载的时间（秒） | 3 |
| 元素描述 | 用自然语言描述要定位的元素 | 搜索按钮 |
| 保存到变量 | 存储生成的选择器 | 搜索按钮选择器 |

**使用示例**：
\`\`\`
AI元素选择器：
  页面URL：https://www.baidu.com
  元素描述：搜索输入框
  保存到变量：输入框选择器
  
输入文本：
  选择器：{输入框选择器}
  内容：Web RPA
\`\`\`

**注意事项**：
- 这两个功能需要消耗AI API额度
- 提取准确性取决于网页结构和AI模型能力
- 复杂页面可能需要多次尝试和调整提示词
- 建议先在测试环境验证效果
- 对于稳定的生产环境，推荐使用传统的CSS选择器方式

---

## 🌐 API请求

发送HTTP请求，与外部服务交互。

### 请求方法

| 方法 | 用途 |
|------|------|
| GET | 获取数据 |
| POST | 提交数据 |
| PUT | 更新数据 |
| DELETE | 删除数据 |
| PATCH | 部分更新 |

### 配置说明

| 参数 | 说明 | 示例 |
|------|------|------|
| URL | 请求地址 | https://api.example.com/data |
| 方法 | HTTP方法 | GET、POST等 |
| 请求头 | HTTP头部 | {"Authorization": "Bearer xxx"} |
| 请求体 | POST/PUT的数据 | {"name": "test"} |
| 保存到变量 | 存储响应结果 | 响应数据 |

### 请求头设置

常用请求头：
\`\`\`json
{
  "Content-Type": "application/json",
  "Authorization": "Bearer {token}",
  "User-Agent": "Mozilla/5.0"
}
\`\`\`

### 请求体格式

JSON格式：
\`\`\`json
{
  "username": "{用户名}",
  "password": "{密码}",
  "data": {数据}
}
\`\`\`

### 使用响应数据

API响应通常是JSON格式，保存到变量后可以这样访问：

\`\`\`
假设响应：{"code": 200, "data": {"name": "test", "items": [1,2,3]}}

{响应[code]}           → 200
{响应[data][name]}     → test
{响应[data][items][0]} → 1
\`\`\`

### 实用示例

#### 1. 获取天气
\`\`\`
URL: https://api.weather.com/v1/current?city={城市}
方法: GET
保存到: 天气数据

然后使用：{天气数据[temperature]}°C
\`\`\`

#### 2. 发送通知
\`\`\`
URL: https://api.pushplus.plus/send
方法: POST
请求体: {
  "token": "{推送token}",
  "title": "价格提醒",
  "content": "{商品名} 降价到 {价格} 元了！"
}
\`\`\`

#### 3. 提交表单数据
\`\`\`
URL: https://api.example.com/submit
方法: POST
请求头: {"Content-Type": "application/json"}
请求体: {
  "name": "{姓名}",
  "email": "{邮箱}",
  "message": "{留言内容}"
}
\`\`\`

---

## 📧 发送邮件

自动发送邮件通知。

### 配置说明

| 参数 | 说明 | 示例 |
|------|------|------|
| SMTP服务器 | 邮件服务器地址 | smtp.qq.com |
| 端口 | 服务器端口 | 465（SSL）或 587（TLS） |
| 发件人邮箱 | 你的邮箱地址 | xxx@qq.com |
| 授权码 | SMTP授权码 | 不是登录密码！ |
| 收件人 | 目标邮箱 | 多个用逗号分隔 |
| 主题 | 邮件标题 | 支持变量 |
| 内容 | 邮件正文 | 支持变量和HTML |

### 获取QQ邮箱授权码

1. 登录 [QQ邮箱网页版](https://mail.qq.com)
2. 点击 **设置** → **账户**
3. 找到 **POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务**
4. 开启 **POP3/SMTP服务**
5. 按提示发送短信验证
6. 获得16位授权码

### 常用SMTP服务器

| 邮箱 | 服务器 | SSL端口 | TLS端口 |
|------|--------|---------|---------|
| QQ邮箱 | smtp.qq.com | 465 | 587 |
| 163邮箱 | smtp.163.com | 465 | 25 |
| Gmail | smtp.gmail.com | 465 | 587 |
| Outlook | smtp.office365.com | - | 587 |

### 邮件内容示例

\`\`\`
主题：【价格监控】{商品名} 降价提醒

内容：
您关注的商品价格有变动：

商品名称：{商品名}
原价：{原价} 元
现价：{现价} 元
降价幅度：{降幅}%

点击查看：{商品链接}

---
此邮件由Web RPA自动发送
\`\`\`

---

## 📥 下载文件

从网页下载文件到本地。

### 下载模式

| 模式 | 说明 | 使用场景 |
|------|------|----------|
| 点击下载 | 点击下载按钮触发下载 | 需要登录或有权限验证的下载 |
| URL下载 | 直接通过URL下载 | 已知文件直链地址 |

### 点击下载模式

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 选择器 | 下载按钮的选择器 | \`#download-btn\` |
| 保存目录 | 文件保存的文件夹 | \`C:/Downloads\` |
| 自定义文件名 | 可选，指定文件名 | \`report.pdf\` |

### URL下载模式

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件URL | 文件的下载地址 | \`https://example.com/file.pdf\` |
| 保存目录 | 文件保存的文件夹 | \`C:/Downloads\` |
| 自定义文件名 | 可选，指定文件名 | \`{日期}_report.pdf\` |

**路径选择**：点击保存目录输入框右侧的 📁 按钮可以通过资源管理器选择文件夹

---

## 📋 剪贴板操作

### 设置剪贴板

将文本或图片设置到系统剪贴板。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 内容类型 | 文本或图片 | text / image |
| 文本内容 | 要复制的文本 | \`{数据}\`，支持变量 |
| 图片路径 | 图片文件路径 | \`C:/images/pic.png\` |

**使用场景**：
- 复制数据到剪贴板供其他程序使用
- 配合键盘操作实现粘贴图片到输入框
- 跨应用数据传递

**示例**：粘贴图片到聊天输入框
\`\`\`
1. 设置剪贴板：图片路径 = C:/images/screenshot.png
2. 点击聊天输入框
3. 键盘操作：Ctrl+V
\`\`\`

---

## ⌨️ 键盘操作

模拟键盘按键和快捷键操作。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 按键组合 | 要按下的键 | \`Ctrl+V\`、\`Enter\`、\`Tab\` |

**支持的按键**：

| 类型 | 按键 |
|------|------|
| 修饰键 | Ctrl、Alt、Shift、Meta（Win键） |
| 功能键 | Enter、Tab、Escape、Backspace、Delete |
| 方向键 | ArrowUp、ArrowDown、ArrowLeft、ArrowRight |
| 其他 | Home、End、PageUp、PageDown、Space |
| 字母数字 | a-z、0-9 |

**常用快捷键示例**：

| 快捷键 | 功能 |
|--------|------|
| Ctrl+A | 全选 |
| Ctrl+C | 复制 |
| Ctrl+V | 粘贴 |
| Ctrl+Z | 撤销 |
| Ctrl+Enter | 发送消息（部分应用） |
| Tab | 切换焦点 |
| Enter | 确认/提交 |
| Escape | 取消/关闭 |

**使用场景**：
- 粘贴剪贴板中的图片
- 提交表单
- 快捷键操作
- 模拟用户键盘输入

---

## 💻 执行JavaScript

在页面中执行自定义JavaScript代码。

### 基础用法

\`\`\`javascript
// 返回值会保存到指定变量
return document.title;
\`\`\`

### 常用示例

**获取页面信息**：
\`\`\`javascript
return {
  title: document.title,
  url: window.location.href,
  scrollHeight: document.body.scrollHeight
};
\`\`\`

**获取所有链接**：
\`\`\`javascript
return Array.from(document.querySelectorAll('a'))
  .map(a => ({text: a.textContent, href: a.href}));
\`\`\`

**修改页面元素**：
\`\`\`javascript
document.querySelector('#element').style.display = 'block';
\`\`\`

**滚动操作**：
\`\`\`javascript
window.scrollTo({top: 1000, behavior: 'smooth'});
\`\`\`

**等待元素**：
\`\`\`javascript
await new Promise(resolve => {
  const check = () => {
    if (document.querySelector('#target')) resolve();
    else setTimeout(check, 100);
  };
  check();
});
return true;
\`\`\`

---

## 🔔 用户输入

在工作流执行过程中弹出对话框，让用户输入数据。

### 配置说明

| 参数 | 说明 |
|------|------|
| 提示文字 | 显示给用户的提示 |
| 默认值 | 输入框的默认内容 |
| 保存到变量 | 存储用户输入的变量名 |

### 使用场景

- 输入验证码
- 输入动态密码
- 确认操作
- 输入搜索关键词

---

## ⏸️ 暂停执行

暂停工作流执行，等待用户手动继续。

### 使用场景

- 需要人工检查
- 等待外部操作完成
- 调试断点

---

## 🔀 并行执行

当一个模块有多条输出连线时，这些分支会**真正并行执行**，大幅提高工作流效率。

### 工作原理

\`\`\`
        ┌─→ 分支A（并行）─┐
模块 ──┼─→ 分支B（并行）─┼─→ 汇合点
        └─→ 分支C（并行）─┘
\`\`\`

系统使用异步执行引擎，当检测到多个分支时会自动并行执行，所有分支完成后才继续执行汇合点后的模块。

### 核心特性

| 特性 | 说明 |
|------|------|
| **真正并行** | 基于异步架构，分支真正同时执行，不是伪并行 |
| **自动检测** | 无需配置，系统自动识别并行分支 |
| **智能汇合** | 多个分支汇合到同一节点时，等待所有分支完成 |
| **线程安全** | 变量操作使用异步锁保护，避免竞争条件 |
| **无限制** | 不限制并行分支数量 |

### 适用场景

#### 1. 并行API请求
\`\`\`
开始
  ├─→ 请求API-A（获取用户信息）
  ├─→ 请求API-B（获取订单列表）
  └─→ 请求API-C（获取商品数据）
      ↓
  汇合：合并所有数据
\`\`\`

#### 2. 并行发送通知
\`\`\`
任务完成
  ├─→ 发送邮件通知
  ├─→ 发送微信推送
  └─→ 写入日志文件
\`\`\`

#### 3. 并行文件处理
\`\`\`
获取文件列表
  ├─→ 下载文件1
  ├─→ 下载文件2
  └─→ 下载文件3
\`\`\`

#### 4. 循环内并行
\`\`\`
遍历商品列表
  └─ 每次循环内：
      ├─→ 获取价格
      ├─→ 获取库存
      └─→ 获取评价
          ↓
      汇合：保存商品数据
\`\`\`

### 汇合机制

当多个分支连接到同一个后续节点时，系统会自动等待所有前驱分支完成：

\`\`\`
分支A ──┐
分支B ──┼─→ 汇合节点（等待A、B、C都完成）
分支C ──┘
\`\`\`

日志中会显示：\`⏳ 等待汇合: 还有 X 个前驱分支未完成\`

### ⚠️ 注意事项

| 注意点 | 说明 | 建议 |
|--------|------|------|
| 浏览器操作 | 并行分支共享同一个浏览器页面 | 浏览器操作建议顺序执行 |
| 变量修改 | 多分支同时修改同一变量可能冲突 | 每个分支使用独立变量 |
| 执行顺序 | 并行分支完成顺序不确定 | 不要依赖特定完成顺序 |
| 错误处理 | 一个分支失败不影响其他分支 | 每个分支独立处理错误 |

### 最佳实践

**✅ 推荐并行的操作**：
- API请求（各自独立的网络请求）
- 文件读写（不同文件）
- 数据计算（无依赖的计算）
- 发送通知（邮件、推送等）
- AI调用（独立的AI请求）
- 数据库操作（独立的查询/插入）

**❌ 不推荐并行的操作**：
- 同一页面的多个浏览器操作
- 有先后依赖的数据处理
- 需要按顺序执行的步骤
- 修改同一个变量的操作

### 性能对比

**顺序执行**：
\`\`\`
API-A(2秒) → API-B(3秒) → API-C(2秒)
总耗时 = 2 + 3 + 2 = 7秒
\`\`\`

**并行执行**：
\`\`\`
      ┌─→ API-A(2秒) ─┐
开始 ─┼─→ API-B(3秒) ─┼─→ 完成
      └─→ API-C(2秒) ─┘
总耗时 = max(2, 3, 2) = 3秒
\`\`\`

**性能提升**：(7-3)/7 ≈ **57%**

### 调试技巧

1. **查看日志**：并行执行时会显示 \`🔀 检测到 X 个分支，并行执行...\`
2. **汇合等待**：汇合时显示 \`⏳ 等待汇合: 还有 X 个前驱分支未完成\`
3. **完成提示**：所有分支完成后显示 \`🔀 X 个分支执行完成\`

---

## 🗄️ 数据库操作

Web RPA 支持连接 MySQL 数据库进行增删改查操作。详细内容请参阅 **🗄️ 数据库操作** 章节。

### 快速概览

| 模块 | 功能 |
|------|------|
| 连接数据库 | 建立MySQL连接 |
| 查询数据 | SELECT查询 |
| 执行SQL | 执行任意SQL语句 |
| 插入数据 | INSERT操作 |
| 更新数据 | UPDATE操作 |
| 删除数据 | DELETE操作 |
| 关闭连接 | 断开数据库连接 |

### 典型流程

\`\`\`
连接数据库 → 执行操作 → 关闭连接
\`\`\`

### 使用场景

- 采集数据直接入库
- 从数据库读取配置
- 数据同步和更新
- 定时清理过期数据

---

## 🖥️ 系统操作模块

Web RPA 提供了一系列系统级操作模块，可以控制鼠标、键盘、执行命令等。

### 🎯 坐标拾取功能

在配置需要屏幕坐标的模块时（如真实鼠标点击、真实鼠标移动、真实鼠标拖拽、屏幕截图自定义区域），可以使用**可视化坐标拾取**功能，无需手动输入坐标数值。

**使用方法**：

1. 在坐标输入框旁边点击「拾取」按钮
2. 鼠标移动到目标位置
3. 按住 **Ctrl + 左键** 确认坐标
4. 坐标会自动填入输入框

**操作说明**：

| 操作 | 效果 |
|------|------|
| **Ctrl + 左键** | 确认并获取当前鼠标位置坐标 |
| **Ctrl + 右键** | 取消拾取操作 |
| **ESC** | 取消拾取操作 |

**适用模块**：
- 真实鼠标点击
- 真实鼠标移动
- 真实鼠标拖拽
- 屏幕截图（自定义区域）

💡 **提示**：使用 Ctrl 组合键可以避免误触发其他应用的点击事件。

---

### 真实鼠标点击

使用系统级 SendInput API 模拟真实的硬件级鼠标点击，可以点击任何屏幕位置和任何应用程序。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| X坐标 | 屏幕X坐标 | \`500\`，支持变量和拾取 |
| Y坐标 | 屏幕Y坐标 | \`300\`，支持变量和拾取 |
| 鼠标按键 | 左键/右键/中键 | left |
| 点击类型 | 单击/双击/长按 | single |
| 长按时长 | 长按模式下的持续时间（毫秒） | 1000 |

**使用场景**：
- 点击浏览器外的应用程序
- 点击无法通过选择器定位的元素
- 配合"获取鼠标位置"使用
- 长按操作（如拖拽前的准备）

💡 点击「拾取」按钮，然后 Ctrl+左键 可视化选择点击位置

---

### 真实鼠标移动

将鼠标移动到指定屏幕坐标。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| X坐标 | 目标X坐标 | \`500\`，支持拾取 |
| Y坐标 | 目标Y坐标 | \`300\`，支持拾取 |
| 移动时长 | 移动动画时长（毫秒） | 0=瞬移，>0=平滑移动 |

💡 点击「拾取」按钮，然后 Ctrl+左键 可视化选择目标位置

---

### 真实鼠标拖拽

从起点长按鼠标拖拽到终点，适用于拖放操作、滑块验证等场景。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 起点X坐标 | 拖拽起点X坐标 | \`100\`，支持拾取 |
| 起点Y坐标 | 拖拽起点Y坐标 | \`200\`，支持拾取 |
| 终点X坐标 | 拖拽终点X坐标 | \`500\`，支持拾取 |
| 终点Y坐标 | 拖拽终点Y坐标 | \`200\`，支持拾取 |
| 鼠标按键 | 左键/右键/中键 | left |
| 拖拽时长 | 拖拽过程持续时间（毫秒） | 500 |

**使用场景**：
- 滑块验证码
- 拖放文件或元素
- 调整滑动条
- 绘图操作

💡 点击「拾取」按钮，然后 Ctrl+左键 可视化选择起点和终点位置

**示例**：滑块验证码
\`\`\`
真实鼠标拖拽：
  起点：(100, 300) - 滑块初始位置
  终点：(400, 300) - 滑块目标位置
  拖拽时长：800ms
  
→ 模拟人工拖动滑块
\`\`\`

---

### 真实鼠标滚动

使用系统级滚轮模拟，可绕过网页的防滚动检测。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 滚动方向 | 向上/向下 | down |
| 滚动量 | 每次滚动的格数 | 3 |
| 滚动次数 | 执行滚动的次数 | 5 |
| 滚动间隔 | 每次滚动的间隔（毫秒） | 100 |

**使用场景**：
- 有防滚动检测的网站（如抖音）
- 需要真实用户行为的场景

---

### 真实键盘操作

使用系统级API模拟键盘输入。

**输入类型**：

| 类型 | 说明 | 示例 |
|------|------|------|
| 输入文本 | 逐字符输入文本 | 支持中文和变量 |
| 按键操作 | 按下单个按键 | Enter、Tab、F5等 |
| 组合键 | 按下快捷键 | ctrl+c、alt+tab |

**使用场景**：
- 输入到非浏览器应用
- 执行系统快捷键
- 模拟真实打字效果

---

### 获取鼠标位置

获取当前鼠标在屏幕上的坐标。

**配置项**：

| 参数 | 说明 |
|------|------|
| X坐标变量名 | 存储X坐标的变量 |
| Y坐标变量名 | 存储Y坐标的变量 |

**使用场景**：
- 记录用户点击位置
- 配合"真实鼠标点击"使用
- 调试定位问题

---

### 点击图像

在屏幕上查找指定图像并点击。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 图像路径 | 要查找的图像文件 | \`C:/images/button.png\` |
| 匹配精度 | 0.1-1.0，越高越严格 | 0.8 |
| 鼠标按键 | 左键/右键/中键 | left |
| 点击类型 | 单击/双击 | single |
| 等待超时 | 查找图像的超时时间（秒） | 10 |

**使用场景**：
- 点击无法通过选择器定位的元素
- 操作桌面应用程序
- 图像识别自动化

**注意**：需要安装 opencv-python 和 Pillow 库

---

### 屏幕截图

截取整个屏幕或指定区域。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 保存路径 | 截图保存的文件夹 | \`C:/screenshots\` |
| 文件名 | 截图文件名 | 留空自动生成时间戳 |
| 截图区域 | 全屏/自定义区域 | full |
| 存储变量名 | 保存截图路径的变量 | screenshot_path |

**自定义区域（两点定位）**：
- 左上角坐标：截图区域的起点（支持 Ctrl+左键 拾取）
- 右下角坐标：截图区域的终点（支持 Ctrl+左键 拾取）

**使用方法**：
1. 选择"自定义区域（两点定位）"
2. 点击第一个「拾取」按钮，Ctrl+左键 选择左上角位置
3. 点击第二个「拾取」按钮，Ctrl+左键 选择右下角位置
4. 系统会自动计算并显示截图区域大小

💡 两点定位更直观，无需手动计算宽高

---

### 文件重命名

重命名指定文件。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 源文件路径 | 要重命名的文件 | \`C:/data/old.txt\` |
| 新文件名 | 新的文件名 | \`new.txt\`，支持变量 |
| 存储变量名 | 保存新路径的变量 | new_path |

---

### 执行命令

执行系统命令（CMD或PowerShell）。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 命令 | 要执行的命令 | \`dir C:\\\\Users\` |
| 执行方式 | CMD/PowerShell | cmd |
| 超时时间 | 命令执行超时（秒） | 30 |
| 存储变量名 | 保存命令输出的变量 | output |

**⚠️ 安全警告**：请谨慎执行系统命令，避免执行未知来源的命令。

---

### 关机/重启

执行系统电源操作。

**操作类型**：

| 类型 | 说明 |
|------|------|
| 关机 | 关闭计算机 |
| 重启 | 重新启动计算机 |
| 注销 | 注销当前用户 |
| 休眠 | 进入休眠模式 |
| 睡眠 | 进入睡眠模式 |

**配置项**：
- 延迟时间：执行前等待的秒数
- 强制执行：是否强制关闭程序

---

### 锁定屏幕

锁定Windows屏幕，相当于按下 Win+L。

---

## ⚠️ 异常处理

每个模块都有一个**橙色的异常处理连接点**（位于模块右侧），当模块执行失败时，会自动触发连接到该点的流程。

### 工作原理

\`\`\`
                    ┌─→ 异常处理流程
模块 ──┬─→ 正常流程  │
       └─→ (error) ─┘
\`\`\`

- **正常流程**：模块执行成功时，从底部连接点继续
- **异常处理**：模块执行失败时，从右侧橙色连接点触发

### 使用方法

1. 从模块右侧的**橙色连接点**拖出连线
2. 连接到异常处理模块（如打印日志、发送通知等）
3. 当该模块执行失败时，会自动执行异常处理流程

### 示例：网络请求异常处理

\`\`\`
API请求 ──┬─→ 处理响应数据 → 继续流程
          └─→ (error) → 打印日志："请求失败" → 发送通知
\`\`\`

### 示例：元素点击异常处理

\`\`\`
点击元素 ──┬─→ 继续操作
           └─→ (error) → 截图保存 → 重试逻辑
\`\`\`

### 特性

| 特性 | 说明 |
|------|------|
| **自动触发** | 模块失败时自动执行异常处理分支 |
| **并行支持** | 异常处理分支支持并行执行多个模块 |
| **不影响主流程** | 有异常处理时，失败不会中断整个工作流 |
| **所有模块支持** | 每个模块都有异常处理连接点 |

### 最佳实践

**✅ 推荐的异常处理**：
- 记录错误日志
- 发送失败通知
- 保存错误截图
- 执行重试逻辑
- 设置默认值继续执行

**示例：完整的异常处理流程**
\`\`\`
打开网页 ──┬─→ 正常流程...
           └─→ (error) → 打印日志 → 等待5秒 → 重新打开网页
\`\`\`

---

## 🎬 媒体处理

Web RPA 内置了强大的媒体处理功能，基于 FFmpeg 实现，支持视频、音频、图片的格式转换、压缩、裁剪等操作。

### 前置要求

媒体处理模块需要 \`backend\` 目录下存在 \`ffmpeg.exe\` 和 \`ffprobe.exe\` 文件。

---

### 格式转换

将视频、音频或图片转换为其他格式。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 媒体类型 | 视频/音频/图片 | video |
| 输入文件路径 | 源文件路径 | \`C:/videos/input.avi\` |
| 输出格式 | 目标格式 | mp4、mp3、jpg等 |
| 输出文件路径 | 可选，留空自动生成 | \`C:/videos/output.mp4\` |
| 结果变量名 | 存储输出路径的变量 | converted_path |

**支持的格式**：

| 类型 | 输入格式 | 输出格式 |
|------|----------|----------|
| 视频 | mp4, avi, mkv, mov, wmv, flv, webm | mp4, avi, mkv, mov, webm, gif |
| 音频 | mp3, wav, flac, aac, m4a, ogg, wma | mp3, wav, flac, aac, ogg, m4a |
| 图片 | jpg, png, gif, bmp, webp, tiff | jpg, png, webp, gif, bmp |

**示例**：将AVI转换为MP4
\`\`\`
格式转换：
  媒体类型：视频
  输入文件：C:/videos/movie.avi
  输出格式：mp4
  
→ 输出：C:/videos/movie_converted.mp4
\`\`\`

---

### 图片压缩

压缩图片文件大小，支持调整质量和尺寸。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 输入图片路径 | 源图片路径 | \`C:/images/photo.jpg\` |
| 压缩质量 | 1-100，越小压缩越多 | 80 |
| 最大宽度 | 可选，限制宽度 | 1920 |
| 最大高度 | 可选，限制高度 | 1080 |
| 输出文件路径 | 可选，留空覆盖源文件 | |
| 结果变量名 | 存储输出路径的变量 | compressed_image |

**使用场景**：
- 批量压缩照片节省存储空间
- 上传前压缩图片减少传输时间
- 生成缩略图

**示例**：压缩图片到80%质量
\`\`\`
图片压缩：
  输入图片：C:/images/photo.jpg
  压缩质量：80
  最大宽度：1920
  
→ 压缩率：约60%
\`\`\`

---

### 视频压缩

压缩视频文件大小，支持调整质量和分辨率。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 输入视频路径 | 源视频路径 | \`C:/videos/movie.mp4\` |
| 压缩预设 | 速度与质量平衡 | medium |
| 质量等级(CRF) | 0-51，越大压缩越多 | 23 |
| 分辨率 | 可选，降低分辨率 | 1280x720 |
| 输出文件路径 | 可选，留空自动生成 | |
| 结果变量名 | 存储输出路径的变量 | compressed_video |

**压缩预设说明**：

| 预设 | 速度 | 质量 | 适用场景 |
|------|------|------|----------|
| ultrafast | 最快 | 较低 | 快速预览 |
| fast | 快 | 中等 | 日常使用 |
| medium | 中等 | 较好 | 推荐默认 |
| slow | 慢 | 高 | 最终输出 |
| veryslow | 最慢 | 最高 | 追求极致 |

**CRF值参考**：

| CRF | 质量 | 文件大小 |
|-----|------|----------|
| 18 | 接近无损 | 较大 |
| 23 | 默认，高质量 | 中等 |
| 28 | 中等质量 | 较小 |
| 35 | 低质量 | 很小 |

**示例**：压缩视频到720p
\`\`\`
视频压缩：
  输入视频：C:/videos/4k_movie.mp4
  压缩预设：medium
  CRF：23
  分辨率：1280x720
  
→ 压缩率：约70%
\`\`\`

---

### 提取音频

从视频文件中提取音频轨道。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 输入视频路径 | 源视频路径 | \`C:/videos/movie.mp4\` |
| 音频格式 | 输出音频格式 | mp3 |
| 音频比特率 | 音频质量 | 192k |
| 输出文件路径 | 可选，留空自动生成 | |
| 结果变量名 | 存储输出路径的变量 | extracted_audio |

**比特率参考**：

| 比特率 | 质量 | 适用场景 |
|--------|------|----------|
| 128k | 一般 | 语音、播客 |
| 192k | 较好 | 推荐默认 |
| 256k | 高 | 音乐 |
| 320k | 最高 | 发烧友 |

**示例**：从视频提取MP3音频
\`\`\`
提取音频：
  输入视频：C:/videos/mv.mp4
  音频格式：mp3
  比特率：192k
  
→ 输出：C:/videos/mv.mp3
\`\`\`

---

### 视频裁剪

截取视频的指定时间段。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 输入视频路径 | 源视频路径 | \`C:/videos/movie.mp4\` |
| 开始时间 | 裁剪起点 | 00:01:30 或 90 |
| 结束时间 | 裁剪终点，留空到结尾 | 00:05:00 |
| 输出文件路径 | 可选，留空自动生成 | |
| 结果变量名 | 存储输出路径的变量 | trimmed_video |

**时间格式**：
- \`HH:MM:SS\` - 时:分:秒，如 \`00:01:30\`
- 秒数 - 直接填数字，如 \`90\`

**示例**：截取1分30秒到5分钟的片段
\`\`\`
视频裁剪：
  输入视频：C:/videos/movie.mp4
  开始时间：00:01:30
  结束时间：00:05:00
  
→ 输出3分30秒的视频片段
\`\`\`

---

### 媒体合并

将多个视频或音频文件合并为一个。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 合并类型 | 视频/音频 | video |
| 输入文件列表 | 包含文件路径的列表变量 | \`{视频列表}\` |
| 输出文件路径 | 合并后的文件路径 | \`C:/videos/merged.mp4\` |
| 结果变量名 | 存储输出路径的变量 | merged_file |

**使用方法**：
1. 先用"列表操作"创建文件路径列表
2. 将列表变量名填入"输入文件列表"

**示例**：合并多个视频片段
\`\`\`
设置变量：视频列表 = ["C:/v1.mp4", "C:/v2.mp4", "C:/v3.mp4"]

媒体合并：
  合并类型：视频
  输入文件列表：{视频列表}
  输出文件：C:/merged.mp4
\`\`\`

**注意**：合并的文件应具有相同的编码格式和分辨率，否则可能失败。

---

### 添加水印

给视频或图片添加图片水印或文字水印。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 媒体类型 | 视频/图片 | video |
| 输入文件路径 | 源文件路径 | \`C:/videos/movie.mp4\` |
| 水印类型 | 图片水印/文字水印 | image |
| 水印图片路径 | 图片水印的图片文件 | \`C:/logo.png\` |
| 水印文字 | 文字水印的内容 | © 2024 |
| 字体大小 | 文字水印的字号 | 24 |
| 字体颜色 | 文字水印的颜色 | white |
| 水印位置 | 水印放置位置 | bottomright |
| 透明度 | 0-1，水印透明度 | 0.8 |
| 输出文件路径 | 可选，留空自动生成 | |
| 结果变量名 | 存储输出路径的变量 | watermarked_file |

**水印位置**：

| 位置 | 说明 |
|------|------|
| topleft | 左上角 |
| topright | 右上角 |
| bottomleft | 左下角 |
| bottomright | 右下角（推荐） |
| center | 居中 |

**示例**：添加Logo水印到视频右下角
\`\`\`
添加水印：
  媒体类型：视频
  输入文件：C:/videos/movie.mp4
  水印类型：图片水印
  水印图片：C:/logo.png
  位置：右下角
  透明度：0.8
\`\`\`

**示例**：添加文字水印
\`\`\`
添加水印：
  媒体类型：图片
  输入文件：C:/images/photo.jpg
  水印类型：文字水印
  水印文字：© 2024 My Company
  字体大小：24
  字体颜色：white
  位置：右下角
  透明度：0.7
\`\`\`

---

### 媒体处理最佳实践

**批量处理**：
\`\`\`
获取文件列表 → 遍历列表 → 格式转换/压缩 → 保存结果
\`\`\`

**视频处理流水线**：
\`\`\`
下载视频 → 裁剪片段 → 压缩 → 添加水印 → 上传
\`\`\`

**注意事项**：
- 大文件处理可能需要较长时间，建议设置足够的超时时间
- 视频压缩是CPU密集型操作，会占用较多系统资源
- 建议在处理前检查磁盘空间是否充足

---

## 🧠 AI识别

Web RPA 提供了基于AI的图像识别功能，包括人脸识别和图片OCR文字识别。

---

### 人脸识别

比较两张图片中的人脸是否匹配，可用于身份验证、人脸比对等场景。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 识别图片路径 | 待识别的图片（可包含多个人脸） | \`C:/images/photo.jpg\` |
| 目标人脸图片 | 用于比对的目标人脸图片 | \`C:/images/target.jpg\` |
| 匹配容差 | 0-1，越小越严格 | 0.6（默认） |
| 结果变量名 | 存储识别结果的变量 | face_match_result |

**分支输出**：

人脸识别模块有两个输出分支（类似条件判断）：
- **✓ 匹配**：检测到匹配的人脸时执行
- **✗ 不匹配**：未检测到匹配的人脸时执行

**结果变量内容**：

\`\`\`json
{
  "matched": true,
  "confidence": 85.5,
  "source_faces": 3,
  "target_faces": 1,
  "best_distance": 0.145
}
\`\`\`

| 字段 | 说明 |
|------|------|
| matched | 是否匹配 |
| confidence | 匹配置信度（百分比） |
| source_faces | 识别图片中检测到的人脸数量 |
| target_faces | 目标图片中检测到的人脸数量 |
| best_distance | 最佳匹配距离（越小越相似） |

**容差值参考**：

| 容差 | 说明 | 适用场景 |
|------|------|----------|
| 0.4 | 非常严格 | 高安全性验证 |
| 0.5 | 较严格 | 一般身份验证 |
| 0.6 | 默认值 | 推荐使用 |
| 0.7 | 较宽松 | 相似人脸查找 |

**示例**：员工打卡验证
\`\`\`
人脸识别：
  识别图片：{摄像头截图}
  目标人脸：C:/employees/{工号}.jpg
  容差：0.5
  
  ├─ 匹配 → 记录打卡成功
  └─ 不匹配 → 提示验证失败
\`\`\`

**注意事项**：
- 首次使用需要安装 face_recognition 库（依赖 dlib）
- 图片中应包含清晰的正面人脸
- 光线、角度会影响识别准确度
- 建议使用高质量的目标人脸图片

---

### 图片OCR

识别图片中的文字内容，支持中英文混合识别。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 图片路径 | 要识别的图片文件 | \`C:/images/text.png\` |
| 结果变量名 | 存储识别文本的变量 | ocr_text |

**使用场景**：
- 识别图片中的文字信息
- 提取截图中的数据
- 识别扫描文档内容
- 读取图片验证码

**示例**：提取截图中的价格
\`\`\`
截图保存 → 图片OCR → 正则提取价格 → 保存数据
\`\`\`

**示例**：批量识别图片文字
\`\`\`
遍历图片列表：
  ├─ 图片OCR：{item}
  ├─ 打印日志：识别结果: {ocr_text}
  └─ 保存到列表
\`\`\`

**注意事项**：
- 使用 ddddocr 库进行识别（项目已内置）
- 图片清晰度会影响识别准确度
- 支持 jpg、png、bmp 等常见图片格式
- 复杂排版的文字可能识别不完整

---

## 📁 文件操作

Web RPA 提供了完整的本地文件操作功能，可以对文件和文件夹进行读取、写入、复制、移动、删除等操作。

---

### 获取文件列表

获取指定文件夹中的所有文件或子文件夹名称，结果保存为列表变量，可用于遍历处理。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件夹路径 | 要扫描的文件夹 | \`C:/data\`，支持变量 |
| 获取类型 | 仅文件/仅文件夹/全部 | files |
| 文件名格式 | 是否包含扩展名 | 包含扩展名 |
| 过滤模式 | 可选，通配符过滤 | \`*.txt\` 或 \`*.jpg;*.png\` |
| 结果变量名 | 存储文件名列表的变量 | file_list |

**过滤模式说明**：
- 支持通配符 \`*\` 匹配任意字符
- 多个模式用分号 \`;\` 分隔
- 示例：\`*.txt\` 只获取txt文件，\`*.jpg;*.png\` 获取jpg和png文件

**示例**：获取文件夹中所有图片
\`\`\`
获取文件列表：
  文件夹路径：C:/images
  获取类型：仅文件
  过滤模式：*.jpg;*.png;*.gif
  结果变量：image_list

→ image_list = ["photo1.jpg", "photo2.png", "banner.gif"]
\`\`\`

**配合遍历使用**：
\`\`\`
获取文件列表 → 遍历列表 → 处理每个文件
\`\`\`

---

### 复制文件

将文件复制到指定位置。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 源文件路径 | 要复制的文件 | \`C:/data/file.txt\` |
| 目标路径 | 目标文件夹或完整路径 | \`D:/backup/\` |
| 覆盖已存在文件 | 是否覆盖同名文件 | 是 |
| 结果变量名 | 存储新文件路径的变量 | copied_path |

**目标路径说明**：
- 如果是文件夹路径（以 \`/\` 或 \`\\\` 结尾），保持原文件名
- 如果是完整文件路径，可以同时重命名

**示例**：备份文件
\`\`\`
复制文件：
  源文件：C:/data/report.xlsx
  目标路径：D:/backup/
  
→ 复制到 D:/backup/report.xlsx
\`\`\`

---

### 移动文件

将文件移动到指定位置（剪切）。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 源文件路径 | 要移动的文件 | \`C:/downloads/file.zip\` |
| 目标路径 | 目标文件夹或完整路径 | \`D:/archive/\` |
| 覆盖已存在文件 | 是否覆盖同名文件 | 是 |
| 结果变量名 | 存储新文件路径的变量 | moved_path |

**示例**：整理下载文件
\`\`\`
移动文件：
  源文件：C:/downloads/{文件名}
  目标路径：D:/documents/
  
→ 文件从 downloads 移动到 documents
\`\`\`

---

### 删除文件

删除指定的文件或文件夹。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件/文件夹路径 | 要删除的路径 | \`C:/temp/old.txt\` |
| 删除类型 | 文件/文件夹（包含内容） | 文件 |

**⚠️ 警告**：删除操作不可恢复，请谨慎使用！

**示例**：清理临时文件
\`\`\`
删除文件：
  路径：C:/temp/cache.tmp
  类型：文件
\`\`\`

**示例**：删除整个文件夹
\`\`\`
删除文件：
  路径：C:/temp/old_data
  类型：文件夹（包含内容）
  
→ 删除文件夹及其所有内容
\`\`\`

---

### 创建文件夹

创建新的文件夹，支持创建多级目录。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件夹路径 | 要创建的文件夹路径 | \`C:/data/2024/01\` |
| 结果变量名 | 存储创建的路径 | folder_path |

**特性**：
- 自动创建所有父目录
- 如果文件夹已存在，不会报错

**示例**：按日期创建文件夹
\`\`\`
获取时间 → 创建文件夹：C:/data/{年}/{月}/{日}
\`\`\`

---

### 文件是否存在

检查指定的文件或文件夹是否存在。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件/文件夹路径 | 要检查的路径 | \`C:/data/config.json\` |
| 结果变量名 | 存储结果（true/false） | exists |

**配合条件判断使用**：
\`\`\`
文件是否存在 → 条件判断：{exists} == true
  ├─ 真 → 读取文件
  └─ 假 → 创建默认文件
\`\`\`

---

### 获取文件信息

获取文件的详细信息，包括大小、创建时间、修改时间等。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件路径 | 要获取信息的文件 | \`C:/data/report.pdf\` |
| 结果变量名 | 存储文件信息的变量 | file_info |

**返回的信息**：

\`\`\`json
{
  "name": "report.pdf",
  "path": "C:/data/report.pdf",
  "size": 1048576,
  "extension": ".pdf",
  "created_time": "2024-01-15 10:30:00",
  "modified_time": "2024-01-20 14:25:00",
  "is_file": true,
  "is_folder": false
}
\`\`\`

**访问文件信息**：
\`\`\`
{file_info[name]}          → report.pdf
{file_info[size]}          → 1048576（字节）
{file_info[extension]}     → .pdf
{file_info[modified_time]} → 2024-01-20 14:25:00
\`\`\`

---

### 读取文本文件

读取文本文件的内容到变量中。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件路径 | 要读取的文本文件 | \`C:/data/config.txt\` |
| 文件编码 | 文件的字符编码 | UTF-8 |
| 结果变量名 | 存储文件内容的变量 | file_content |

**支持的编码**：
- UTF-8（推荐，默认）
- GBK（中文Windows常用）
- GB2312
- UTF-16
- ASCII

**示例**：读取配置文件
\`\`\`
读取文本文件：
  文件路径：C:/config/settings.json
  编码：UTF-8
  结果变量：config_text

→ 然后可以用 JSON解析 处理内容
\`\`\`

**示例**：读取日志文件
\`\`\`
读取文本文件：
  文件路径：C:/logs/app.log
  编码：UTF-8
  结果变量：log_content

→ 然后可以用 正则提取 分析日志
\`\`\`

---

### 写入文本文件

将文本内容写入文件，支持覆盖和追加模式。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件路径 | 要写入的文件路径 | \`C:/data/output.txt\` |
| 写入内容 | 要写入的文本 | 支持变量 \`{数据}\` |
| 文件编码 | 文件的字符编码 | UTF-8 |
| 写入模式 | 覆盖/追加 | 覆盖 |
| 结果变量名 | 存储文件路径的变量 | write_path |

**写入模式说明**：
- **覆盖**：清空文件原有内容，写入新内容
- **追加**：在文件末尾添加新内容

**示例**：保存采集数据
\`\`\`
写入文本文件：
  文件路径：C:/data/result.txt
  内容：{商品名称},{价格},{库存}
  模式：追加
  
→ 每次执行追加一行数据
\`\`\`

**示例**：保存JSON数据
\`\`\`
写入文本文件：
  文件路径：C:/data/config.json
  内容：{"name": "{名称}", "value": {数值}}
  模式：覆盖
\`\`\`

---

### 文件操作最佳实践

**批量文件处理**：
\`\`\`
获取文件列表 → 遍历列表 → 处理每个文件 → 移动到完成文件夹
\`\`\`

**数据导出流程**：
\`\`\`
采集数据 → 创建文件夹（按日期） → 写入文本文件
\`\`\`

**文件备份流程**：
\`\`\`
文件是否存在 → 复制文件到备份目录 → 删除原文件
\`\`\`

**配置文件读写**：
\`\`\`
读取文本文件 → JSON解析 → 修改配置 → 写入文本文件
\`\`\`

**注意事项**：
- 操作前建议先用"文件是否存在"检查
- 删除操作不可恢复，建议先备份
- 大文件读取可能占用较多内存
- 写入时确保目标文件夹存在（或使用"创建文件夹"）

---

## 💬 QQ自动化

Web RPA 支持通过 NapCat（OneBot协议）实现 QQ 消息自动化，可以发送消息、图片，获取好友/群列表，以及等待接收消息。

### 前置要求

1. 安装并运行 NapCat（项目已内置于 NapCat 文件夹）
2. 在 NapCat 中登录 QQ 账号
3. 确保 OneBot HTTP 服务已启动（默认端口 3000）

### 连接状态

在工具栏可以看到 NapCat 连接状态：
- 🟢 绿色：已连接
- 🔴 红色：未连接

点击状态图标可以打开 NapCat 设置面板，配置 HTTP 端口。

---

### QQ发送消息

向指定好友或群发送文本消息。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 消息类型 | 私聊/群聊 | private |
| 目标ID | QQ号或群号 | \`123456789\`，支持变量 |
| 消息内容 | 要发送的文本 | \`你好！{变量}\` |
| 结果变量名 | 存储发送结果的变量 | qq_msg_result |

**示例**：发送私聊消息
\`\`\`
QQ发送消息：
  消息类型：私聊
  目标ID：123456789
  消息内容：你好，这是自动发送的消息！
\`\`\`

**示例**：发送群消息
\`\`\`
QQ发送消息：
  消息类型：群聊
  目标ID：987654321
  消息内容：大家好！今日签到提醒~
\`\`\`

---

### QQ发送图片

向指定好友或群发送图片。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 消息类型 | 私聊/群聊 | private |
| 目标ID | QQ号或群号 | \`123456789\` |
| 图片来源 | 本地文件/网络URL/Base64 | file |
| 图片路径/URL | 图片的路径或网址 | \`C:/images/pic.jpg\` |
| 结果变量名 | 存储发送结果的变量 | qq_img_result |

**图片来源说明**：

| 来源 | 说明 | 示例 |
|------|------|------|
| 本地文件 | 本地图片文件路径 | \`C:/images/photo.jpg\` |
| 网络URL | 网络图片地址 | \`https://example.com/img.png\` |
| Base64 | Base64编码的图片数据 | \`{base64_image}\` |

**示例**：发送本地图片
\`\`\`
QQ发送图片：
  消息类型：私聊
  目标ID：123456789
  图片来源：本地文件
  图片路径：C:/screenshots/result.png
\`\`\`

---

### QQ发送文件

向指定好友或群发送文件。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 消息类型 | 私聊/群聊 | private |
| 目标ID | QQ号或群号 | \`123456789\` |
| 文件路径 | 本地文件路径 | \`C:/documents/report.pdf\` |
| 文件名 | 可选，自定义显示的文件名 | \`报告.pdf\` |
| 结果变量名 | 存储发送结果的变量 | qq_file_result |

**示例**：发送文件给好友
\`\`\`
QQ发送文件：
  消息类型：私聊
  目标ID：123456789
  文件路径：C:/documents/report.pdf
  文件名：月度报告.pdf
\`\`\`

**示例**：发送文件到群
\`\`\`
QQ发送文件：
  消息类型：群聊
  目标ID：987654321
  文件路径：{下载的文件路径}
\`\`\`

---

### QQ等待消息

等待接收指定条件的 QQ 消息，可用于实现消息触发的自动化流程。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 消息来源 | 私聊/群聊/全部 | private |
| 发送者ID | 可选，指定发送者QQ号 | \`123456789\` |
| 群ID | 群聊时可指定群号 | \`987654321\` |
| 匹配模式 | 包含/完全匹配/正则/任意 | contains |
| 匹配内容 | 要匹配的文本或正则 | \`你好\` |
| 等待超时 | 超时时间（秒），0为无限等待 | 0 |
| 轮询间隔 | 检查消息的间隔（秒） | 0.3 |
| 结果变量名 | 存储接收到的消息 | qq_received_message |

**匹配模式说明**：

| 模式 | 说明 | 示例 |
|------|------|------|
| 包含 | 消息包含指定文本 | 匹配内容：\`你好\` → 匹配"你好啊"、"说你好" |
| 完全匹配 | 消息完全等于指定文本 | 匹配内容：\`你好\` → 只匹配"你好" |
| 正则匹配 | 使用正则表达式匹配 | 匹配内容：\`\\d+\` → 匹配包含数字的消息 |
| 任意消息 | 接收任意消息 | 不需要填写匹配内容 |

**结果变量内容**：

\`\`\`json
{
  "message_id": 123456,
  "sender_id": "123456789",
  "sender_nickname": "用户昵称",
  "group_id": "987654321",
  "group_name": "群名称",
  "message": "消息内容",
  "raw_message": "原始消息",
  "time": 1704067200
}
\`\`\`

**示例**：等待指定用户的消息
\`\`\`
QQ等待消息：
  消息来源：私聊
  发送者ID：123456789
  匹配模式：包含
  匹配内容：确认
  等待超时：0（无限等待）
  
→ 等待用户123456789发送包含"确认"的消息
\`\`\`

**示例**：等待群内任意消息
\`\`\`
QQ等待消息：
  消息来源：群聊
  群ID：987654321
  匹配模式：任意消息
  等待超时：60
  
→ 等待群987654321的任意消息，最多等待60秒
\`\`\`

**配合循环实现消息监听**：
\`\`\`
循环执行 100 次
  ├─ QQ等待消息（匹配：你好）
  ├─ QQ发送消息：你好呀！{qq_received_message[sender_nickname]}
  └─ 打印日志：收到消息来自 {qq_received_message[sender_id]}
\`\`\`

---

### QQ获取好友列表

获取当前登录账号的好友列表。

**配置项**：

| 参数 | 说明 |
|------|------|
| 结果变量名 | 存储好友列表的变量 |

**返回数据格式**：

\`\`\`json
[
  {
    "user_id": "123456789",
    "nickname": "好友昵称",
    "remark": "备注名"
  },
  ...
]
\`\`\`

**示例**：遍历好友发送消息
\`\`\`
QQ获取好友列表 → 遍历列表
  └─ QQ发送消息：{item[user_id]}，新年快乐！
\`\`\`

---

### QQ获取群列表

获取当前登录账号加入的群列表。

**配置项**：

| 参数 | 说明 |
|------|------|
| 结果变量名 | 存储群列表的变量 |

**返回数据格式**：

\`\`\`json
[
  {
    "group_id": "987654321",
    "group_name": "群名称",
    "member_count": 100,
    "max_member_count": 500
  },
  ...
]
\`\`\`

---

### QQ获取群成员列表

获取指定群的成员列表。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 群ID | 要获取成员的群号 | \`987654321\` |
| 结果变量名 | 存储成员列表的变量 | group_members |

**返回数据格式**：

\`\`\`json
[
  {
    "user_id": "123456789",
    "nickname": "昵称",
    "card": "群名片",
    "role": "member"
  },
  ...
]
\`\`\`

---

### QQ获取登录信息

获取当前登录的 QQ 账号信息。

**配置项**：

| 参数 | 说明 |
|------|------|
| 结果变量名 | 存储登录信息的变量 |

**返回数据格式**：

\`\`\`json
{
  "user_id": "123456789",
  "nickname": "我的昵称"
}
\`\`\`

---

### QQ自动化使用场景

#### 1. 消息自动回复机器人
\`\`\`
循环执行（无限）
  ├─ QQ等待消息（匹配：你好）
  └─ QQ发送消息：你好！有什么可以帮助你的？
\`\`\`

#### 2. 定时群发通知
\`\`\`
定时执行（每天9:00）
  ├─ QQ获取群列表
  └─ 遍历群列表
      └─ QQ发送消息：早上好，今日签到开始！
\`\`\`

#### 3. 关键词触发工作流
\`\`\`
QQ等待消息（匹配：查询订单）
  ├─ 正则提取订单号
  ├─ API请求查询订单
  └─ QQ发送消息：订单状态：{订单信息}
\`\`\`

#### 4. 消息转发
\`\`\`
QQ等待消息（来源：私聊）
  └─ QQ发送消息（群聊）：转发消息：{qq_received_message[message]}
\`\`\`

### 注意事项

| 注意点 | 说明 |
|--------|------|
| NapCat状态 | 确保 NapCat 已启动并登录 |
| 消息频率 | 避免发送过于频繁，可能触发风控 |
| 敏感内容 | 不要发送违规内容 |
| 等待超时 | 建议设置合理的超时时间，0为无限等待 |

---

## 💚 微信自动化

Web RPA 支持微信消息自动化，可以发送消息和文件给指定联系人或群。

### 实现原理

由于微信 4.x 使用了全新的 UI 框架，传统的 UI 自动化工具无法支持。本模块采用**图像识别 + 键鼠模拟**的方式实现微信自动化，兼容所有版本微信：

1. 通过窗口标题查找并激活微信窗口
2. 使用 Ctrl+F 打开搜索，输入联系人名称
3. 按 Enter 进入聊天窗口
4. 使用剪贴板粘贴发送内容

### 前置要求

1. 微信已登录并保持窗口打开（可以最小化）
2. 微信窗口标题为"微信"（默认情况）

### 智能优化

- **自动窗口激活**：执行时自动将微信窗口置顶并获取焦点
- **聊天目标缓存**：如果已经在和目标联系人聊天，会跳过搜索步骤，直接发送，节省时间

---

### 微信发送消息

向指定联系人或群发送文本消息。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 目标 | 联系人或群名称 | \`张三\`、\`工作群\` |
| 消息内容 | 要发送的文本 | \`你好！{变量}\` |
| 结果变量名 | 存储发送结果的变量 | wechat_result |

**示例**：发送消息给好友
\`\`\`
微信发送消息：
  目标：张三
  消息内容：你好，这是自动发送的消息！
\`\`\`

**示例**：发送消息到群
\`\`\`
微信发送消息：
  目标：工作群
  消息内容：大家好，今天的会议在下午3点开始。
\`\`\`

---

### 微信发送文件

向指定联系人或群发送文件（支持图片、文档等任意文件）。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 目标 | 联系人或群名称 | \`张三\`、\`工作群\` |
| 文件路径 | 本地文件路径 | \`C:/images/photo.jpg\` |
| 结果变量名 | 存储发送结果的变量 | wechat_file_result |

**示例**：发送图片
\`\`\`
微信发送文件：
  目标：张三
  文件路径：C:/screenshots/result.png
\`\`\`

**示例**：发送文档
\`\`\`
微信发送文件：
  目标：工作群
  文件路径：C:/documents/报告.pdf
\`\`\`

---

### 微信自动化使用场景

#### 1. 定时发送消息
\`\`\`
定时执行（每天9:00）
  └─ 微信发送消息：早上好！
\`\`\`

#### 2. 批量发送通知
\`\`\`
设置变量：联系人列表 = ["张三", "李四", "王五"]

遍历列表：联系人列表
  └─ 微信发送消息：{item}，会议提醒！
\`\`\`

#### 3. 自动发送文件
\`\`\`
下载文件 → 微信发送文件：{下载的文件路径}
\`\`\`

#### 4. 配合其他模块
\`\`\`
采集数据 → 导出Excel → 微信发送文件：{导出的文件}
\`\`\`

### 注意事项

| 注意点 | 说明 |
|--------|------|
| 微信状态 | 确保微信已登录且窗口已打开 |
| 联系人名称 | 使用准确的联系人或群名称，支持备注名 |
| 消息频率 | 避免发送过于频繁，可能触发风控 |
| 文件大小 | 大文件发送可能需要较长时间 |
| 窗口焦点 | 执行时会自动激活微信窗口 |

---

## 🎬 宏录制器

录制鼠标和键盘操作，然后按照录制的顺序和时间间隔自动回放，实现操作自动化。

### 功能概述

宏录制器可以记录以下操作：
- 鼠标移动轨迹
- 鼠标点击（左键、右键、中键）
- 鼠标滚轮滚动
- 键盘按键和文字输入

### 录制操作

**开始录制**：

1. 在配置面板点击「🎬 开始录制」按钮
2. 弹出录制对话框，选择要录制的操作类型
3. 点击「开始录制」后，进行鼠标和键盘操作
4. 完成后点击「⏹️ 停止录制」
5. 点击「保存」将录制数据保存到模块

**录制选项**：

| 选项 | 说明 |
|------|------|
| 鼠标轨迹 | 记录鼠标移动路径 |
| 鼠标点击 | 记录鼠标点击操作 |
| 键盘操作 | 记录键盘按键和输入 |
| 鼠标滚轮 | 记录滚轮滚动操作 |

### 播放配置

| 参数 | 说明 | 示例 |
|------|------|------|
| 播放速度 | 回放速度倍率 | 1x（原速）、2x（快速）、0.5x（慢速） |
| 重复次数 | 重复执行的次数 | 1-9999 |
| 播放鼠标移动轨迹 | 是否回放鼠标移动 | 勾选/取消 |
| 播放鼠标点击 | 是否回放鼠标点击 | 勾选/取消 |
| 播放键盘操作 | 是否回放键盘操作 | 勾选/取消 |
| 使用相对位置 | 从当前鼠标位置开始 | 勾选/取消 |

**播放速度说明**：

| 速度 | 说明 | 适用场景 |
|------|------|----------|
| 0.25x | 慢速 | 调试、演示 |
| 0.5x | 较慢 | 需要观察过程 |
| 1x | 原速 | 正常回放 |
| 2x | 快速 | 加速执行 |
| 5x | 极速 | 快速完成重复任务 |

### 使用场景

#### 1. 重复性操作自动化
\`\`\`
录制：打开软件 → 点击菜单 → 选择选项 → 确认
回放：自动执行相同操作
\`\`\`

#### 2. 游戏脚本
\`\`\`
录制：角色移动路径 → 技能释放 → 物品拾取
回放：自动执行游戏操作
\`\`\`

#### 3. 表单填写
\`\`\`
录制：点击输入框 → 输入内容 → 切换下一个 → 提交
回放：自动填写相同格式的表单
\`\`\`

#### 4. 软件测试
\`\`\`
录制：完整的用户操作流程
回放：重复执行测试用例
\`\`\`

### 示例：自动签到

\`\`\`
1. 录制操作：
   - 点击签到按钮位置
   - 等待弹窗出现
   - 点击确认按钮

2. 配置播放：
   - 播放速度：1x
   - 重复次数：1
   - 勾选：播放鼠标点击

3. 执行：每天定时运行此模块
\`\`\`

### 注意事项

| 注意点 | 说明 |
|--------|------|
| 屏幕分辨率 | 录制和回放时应保持相同的屏幕分辨率 |
| 窗口位置 | 目标窗口应在相同位置，或使用相对位置模式 |
| 时间间隔 | 回放会保持录制时的时间间隔（可通过速度调整） |
| 系统权限 | 需要系统级输入权限才能正常工作 |

### 最佳实践

**✅ 推荐做法**：
- 录制前确定好窗口位置
- 操作时保持稳定的节奏
- 使用相对位置模式提高兼容性
- 先用慢速测试，确认无误后再加速

**❌ 避免做法**：
- 录制过程中切换窗口
- 录制时鼠标移动过快
- 在不同分辨率下回放
- 录制过长的操作序列（建议分段）

### 与其他模块配合

\`\`\`
定时执行 → 宏录制器 → 截图保存 → 发送通知
\`\`\`

\`\`\`
循环执行 5 次
  └─ 宏录制器（重复次数：1）
      └─ 等待 2 秒
\`\`\`

---

## 🎯 鼠标坐标实时显示

在全局设置中开启后，会在鼠标旁边实时显示当前屏幕坐标，方便定位和调试。

### 开启方式

1. 点击工具栏的 **⚙️ 设置** 按钮
2. 找到 **显示设置** 区域
3. 开启 **鼠标坐标实时显示** 开关

### 功能特点

| 特点 | 说明 |
|------|------|
| 实时跟随 | 坐标显示窗口始终跟随鼠标移动 |
| 置顶显示 | 窗口始终在最上层，不会被其他窗口遮挡 |
| 现代化UI | 圆角设计，半透明背景，符合 Web RPA 主题风格 |
| 自动关闭 | 关闭前端或后端时，坐标显示会自动停止 |

### 显示信息

坐标显示窗口包含以下信息：
- **X 坐标**：鼠标在屏幕上的水平位置（像素）
- **Y 坐标**：鼠标在屏幕上的垂直位置（像素）
- **Web RPA 标识**：显示当前为 Web RPA 的坐标工具

### 使用场景

- **调试定位**：查看元素在屏幕上的精确位置
- **配置坐标**：为真实鼠标点击、拖拽等模块获取坐标值
- **截图区域**：确定屏幕截图的区域范围
- **图像识别**：确定搜索区域的坐标范围

### 注意事项

- 坐标显示由后端独立进程控制，不影响工作流执行
- 关闭浏览器或终端时，坐标显示会自动停止
- 如果坐标显示异常，可以在设置中关闭后重新开启
`
