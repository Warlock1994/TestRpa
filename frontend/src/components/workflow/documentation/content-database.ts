export const databaseGuideContent = `# 🗄️ 数据库操作指南

本章详细介绍如何使用数据库模块连接和操作 MySQL 数据库。

---

## 📋 模块概览

Web RPA 提供了完整的数据库操作模块：

| 模块 | 说明 | 主要用途 |
|------|------|----------|
| 🔌 连接数据库 | 建立数据库连接 | 连接 MySQL 服务器 |
| 🔍 查询数据 | SELECT 查询 | 读取数据库数据 |
| ⚡ 执行SQL | 执行任意SQL | DDL语句、存储过程等 |
| ➕ 插入数据 | INSERT 操作 | 添加新记录 |
| ✏️ 更新数据 | UPDATE 操作 | 修改现有记录 |
| 🗑️ 删除数据 | DELETE 操作 | 删除记录 |
| 🔌 关闭连接 | 断开数据库连接 | 释放连接资源 |

---

## 🔌 连接数据库

建立与 MySQL 数据库的连接，是所有数据库操作的前提。

### 配置参数

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| 主机地址 | 数据库服务器地址 | localhost | \`192.168.1.100\` |
| 端口 | 数据库端口 | 3306 | \`3306\` |
| 用户名 | 登录用户名 | - | \`root\` |
| 密码 | 登录密码 | - | \`password123\` |
| 数据库名 | 要连接的数据库 | - | \`mydb\` |
| 字符集 | 连接字符集 | utf8mb4 | \`utf8mb4\` |
| 连接名称 | 连接的标识名 | default | \`主数据库\` |

### 连接名称的作用

连接名称用于区分多个数据库连接。当你需要同时操作多个数据库时，可以创建多个连接：

\`\`\`
连接数据库1：
  主机：192.168.1.100
  数据库：users_db
  连接名称：用户库

连接数据库2：
  主机：192.168.1.101
  数据库：orders_db
  连接名称：订单库

后续操作时指定连接名称即可操作对应的数据库
\`\`\`

### 全局默认配置

在**全局配置 → 数据库**中可以设置默认的数据库连接参数，新建的数据库模块会自动填充这些默认值。

### 使用示例

\`\`\`
连接数据库：
  主机地址：localhost
  端口：3306
  用户名：root
  密码：{数据库密码}
  数据库名：web_rpa
  连接名称：default
\`\`\`

---

## 🔍 查询数据

执行 SELECT 语句查询数据库数据。

### 配置参数

| 参数 | 说明 | 示例 |
|------|------|------|
| 连接名称 | 使用哪个数据库连接 | \`default\` |
| SQL语句 | SELECT 查询语句 | \`SELECT * FROM users\` |
| 结果保存到变量 | 存储查询结果的变量名 | \`用户列表\` |
| 只返回第一行 | 是否只取第一条记录 | 勾选/不勾选 |

### 返回数据格式

**多行结果**（不勾选"只返回第一行"）：
\`\`\`json
[
  {"id": 1, "name": "张三", "email": "zhangsan@example.com"},
  {"id": 2, "name": "李四", "email": "lisi@example.com"}
]
\`\`\`

**单行结果**（勾选"只返回第一行"）：
\`\`\`json
{"id": 1, "name": "张三", "email": "zhangsan@example.com"}
\`\`\`

### 使用变量

SQL语句中可以使用 \`{变量名}\` 引用变量：

\`\`\`sql
SELECT * FROM users WHERE id = {用户ID}
SELECT * FROM products WHERE price < {最高价格}
SELECT * FROM orders WHERE status = '{订单状态}'
\`\`\`

### 访问查询结果

\`\`\`
假设查询结果保存到变量：用户列表

遍历结果：
  遍历列表：用户列表
    打印日志：用户名：{item[name]}，邮箱：{item[email]}

访问单条记录（勾选了"只返回第一行"）：
  打印日志：用户名：{用户[name]}
\`\`\`

### 常用查询示例

**查询所有数据**：
\`\`\`sql
SELECT * FROM users
\`\`\`

**条件查询**：
\`\`\`sql
SELECT * FROM users WHERE age > 18 AND status = 1
\`\`\`

**排序和限制**：
\`\`\`sql
SELECT * FROM products ORDER BY price DESC LIMIT 10
\`\`\`

**联表查询**：
\`\`\`sql
SELECT u.name, o.order_no, o.amount 
FROM users u 
JOIN orders o ON u.id = o.user_id 
WHERE o.status = 'paid'
\`\`\`

**聚合查询**：
\`\`\`sql
SELECT COUNT(*) as total, SUM(amount) as total_amount 
FROM orders 
WHERE created_at > '2024-01-01'
\`\`\`

---

## ⚡ 执行SQL

执行任意 SQL 语句，适用于 DDL 语句、存储过程等。

### 配置参数

| 参数 | 说明 | 示例 |
|------|------|------|
| 连接名称 | 使用哪个数据库连接 | \`default\` |
| SQL语句 | 要执行的SQL | \`CREATE TABLE ...\` |
| 影响行数保存到变量 | 存储受影响行数 | \`affectedRows\` |

### 适用场景

- 创建/修改/删除表结构
- 执行存储过程
- 批量操作
- 其他非查询SQL

### 示例

**创建表**：
\`\`\`sql
CREATE TABLE IF NOT EXISTS logs (
  id INT AUTO_INCREMENT PRIMARY KEY,
  message TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
\`\`\`

**修改表结构**：
\`\`\`sql
ALTER TABLE users ADD COLUMN phone VARCHAR(20)
\`\`\`

**清空表**：
\`\`\`sql
TRUNCATE TABLE temp_data
\`\`\`

---

## ➕ 插入数据

向数据库表中插入新记录。

### 配置参数

| 参数 | 说明 | 示例 |
|------|------|------|
| 连接名称 | 使用哪个数据库连接 | \`default\` |
| 表名 | 要插入数据的表 | \`users\` |
| 插入数据 | JSON格式的数据 | \`{"name": "张三"}\` |
| 插入ID保存到变量 | 存储自增ID | \`lastInsertId\` |

### 数据格式

使用 JSON 格式指定要插入的字段和值：

\`\`\`json
{
  "name": "{用户名}",
  "email": "{邮箱}",
  "age": 25,
  "status": 1
}
\`\`\`

### 使用示例

\`\`\`
插入数据：
  表名：users
  数据：{
    "name": "{采集的用户名}",
    "email": "{采集的邮箱}",
    "source": "web_rpa",
    "created_at": "{当前时间}"
  }
  插入ID保存到：新用户ID

打印日志：成功插入用户，ID：{新用户ID}
\`\`\`

### 批量插入

配合循环可以批量插入数据：

\`\`\`
遍历列表：采集的数据列表
  插入数据：
    表名：products
    数据：{
      "name": "{item[商品名称]}",
      "price": "{item[价格]}",
      "url": "{item[链接]}"
    }
\`\`\`

---

## ✏️ 更新数据

修改数据库中的现有记录。

### 配置参数

| 参数 | 说明 | 示例 |
|------|------|------|
| 连接名称 | 使用哪个数据库连接 | \`default\` |
| 表名 | 要更新的表 | \`users\` |
| 更新数据 | JSON格式的更新内容 | \`{"status": 1}\` |
| WHERE条件 | 更新条件（不含WHERE） | \`id = 1\` |
| 影响行数保存到变量 | 存储受影响行数 | \`updatedRows\` |

### 使用示例

**更新单条记录**：
\`\`\`
更新数据：
  表名：users
  数据：{"status": 1, "updated_at": "{当前时间}"}
  WHERE条件：id = {用户ID}
\`\`\`

**批量更新**：
\`\`\`
更新数据：
  表名：products
  数据：{"on_sale": 0}
  WHERE条件：stock = 0
\`\`\`

### ⚠️ 注意事项

- WHERE条件不要包含 \`WHERE\` 关键字
- 条件中的字符串值需要用引号包裹
- 建议先用查询确认要更新的数据

---

## 🗑️ 删除数据

从数据库表中删除记录。

### 配置参数

| 参数 | 说明 | 示例 |
|------|------|------|
| 连接名称 | 使用哪个数据库连接 | \`default\` |
| 表名 | 要删除数据的表 | \`users\` |
| WHERE条件 | 删除条件（必填） | \`id = 1\` |
| 影响行数保存到变量 | 存储删除的行数 | \`deletedRows\` |

### 使用示例

\`\`\`
删除数据：
  表名：logs
  WHERE条件：created_at < '2024-01-01'
  影响行数保存到：删除数量

打印日志：已删除 {删除数量} 条过期日志
\`\`\`

### ⚠️ 安全警告

- **WHERE条件是必填的**，防止误删全表数据
- 删除操作不可恢复，请谨慎使用
- 建议先用查询确认要删除的数据

---

## 🔌 关闭连接

断开数据库连接，释放资源。

### 配置参数

| 参数 | 说明 | 示例 |
|------|------|------|
| 连接名称 | 要关闭的连接名称 | \`default\` |

### 使用建议

- 工作流结束时建议关闭数据库连接
- 长时间运行的工作流中，不用时及时关闭连接
- 如果不手动关闭，工作流结束时会自动关闭所有连接

---

## 💡 最佳实践

### 1. 连接管理

\`\`\`
工作流开始
  └─ 连接数据库
      └─ 执行数据库操作...
          └─ 关闭连接
              └─ 工作流结束
\`\`\`

### 2. 错误处理

建议在关键操作后检查结果：

\`\`\`
插入数据 → 保存ID到：insertId
条件判断：{insertId} > 0
  ├─ 是 → 打印日志（success）：插入成功
  └─ 否 → 打印日志（error）：插入失败
\`\`\`

### 3. 防止SQL注入

虽然模块会自动处理参数，但仍建议：
- 不要直接拼接用户输入到SQL中
- 使用变量引用而非字符串拼接
- 对用户输入进行验证

### 4. 性能优化

- 只查询需要的字段，避免 \`SELECT *\`
- 合理使用索引
- 批量操作时考虑事务
- 大数据量时使用分页查询

---

## 📚 实战案例

### 案例1：采集数据入库

\`\`\`
1. 连接数据库
2. 打开网页 → 商品列表页
3. 遍历商品列表
   ├─ 获取商品名称
   ├─ 获取商品价格
   ├─ 获取商品链接
   └─ 插入数据：
        表名：products
        数据：{
          "name": "{商品名称}",
          "price": "{价格}",
          "url": "{链接}",
          "created_at": "{当前时间}"
        }
4. 关闭连接
5. 打印日志：采集完成
\`\`\`

### 案例2：数据同步

\`\`\`
1. 连接数据库
2. 查询数据：SELECT * FROM products WHERE sync_status = 0
3. 遍历查询结果
   ├─ API请求：同步到远程服务器
   └─ 更新数据：
        表名：products
        数据：{"sync_status": 1}
        WHERE：id = {item[id]}
4. 关闭连接
\`\`\`

### 案例3：定时清理

\`\`\`
1. 连接数据库
2. 获取时间 → 30天前的日期
3. 删除数据：
     表名：logs
     WHERE：created_at < '{30天前}'
4. 打印日志：已清理 {deletedRows} 条过期日志
5. 关闭连接
\`\`\`

---

## ❓ 常见问题

### Q: 连接失败怎么办？

1. 检查数据库服务是否启动
2. 检查主机地址和端口是否正确
3. 检查用户名和密码是否正确
4. 检查数据库是否允许远程连接
5. 检查防火墙设置

### Q: 中文乱码怎么办？

确保字符集设置为 \`utf8mb4\`，同时数据库表的字符集也应该是 \`utf8mb4\`。

### Q: 如何处理大量数据？

1. 使用分页查询：\`LIMIT offset, count\`
2. 使用游标
3. 分批处理，避免一次性加载过多数据

### Q: 支持其他数据库吗？

目前仅支持 MySQL 数据库。如需支持其他数据库（PostgreSQL、SQLite等），请联系作者。`

