export const triggersGuideContent = `# ⚡ 触发器使用指南

## 概述

触发器模块允许工作流在特定条件满足时自动执行，实现真正的自动化。WebRPA提供了10种强大的触发器，覆盖各种自动化场景。

### 触发器工作流程

\`\`\`mermaid
%%{init: {'theme':'default', 'themeVariables': { 'fontSize':'16px'}}}%%
graph TD
    A["<b>工作流启动</b>"] --> B{"<b>触发器类型</b>"}
    B -->|Webhook| C["等待HTTP请求"]
    B -->|热键| D["监听键盘组合键"]
    B -->|文件监控| E["监控文件变化"]
    B -->|邮件| F["检查新邮件"]
    B -->|API| G["轮询API接口"]
    B -->|鼠标| H["监听鼠标事件"]
    B -->|图像| I["检测屏幕图像"]
    B -->|声音| J["监听声音事件"]
    B -->|人脸| K["识别人脸"]
    B -->|元素变化| L["监控DOM变化"]
    
    C --> M["<b>触发条件满足</b>"]
    D --> M
    E --> M
    F --> M
    G --> M
    H --> M
    I --> M
    J --> M
    K --> M
    L --> M
    
    M --> N["执行后续模块"]
    N --> O["<b>工作流完成</b>"]
    
    style A fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    style B fill:#fff9c4,stroke:#f57f17,stroke-width:3px,color:#000
    style M fill:#fff3e0,stroke:#f57c00,stroke-width:3px,color:#000
    style O fill:#e8f5e9,stroke:#388e3c,stroke-width:3px,color:#000
\`\`\`

---

## 🌐 Webhook触发器

### 功能说明
等待HTTP请求触发工作流，可用于接收外部系统的通知或回调。

### 配置项
- **Webhook ID**：自动生成的唯一标识符
- **Webhook URL**：接收请求的地址（可复制）
- **HTTP方法**：允许的请求方法（GET/POST/PUT/DELETE/ANY）
- **验证请求头**：可选，只有匹配的请求头才触发
- **验证查询参数**：可选，只有匹配的参数才触发
- **自定义响应内容**：可选，返回给请求方的JSON响应
- **响应状态码**：HTTP响应状态码（默认200）
- **超时时间**：等待时间（0=无限等待）
- **保存数据到变量**：请求数据保存的变量名

### 使用场景
- 接收第三方系统的回调通知
- 实现API接口触发工作流
- 接收Webhook事件（如GitHub、钉钉等）
- 远程触发工作流执行

### 示例：接收GitHub Webhook
\`\`\`
配置：
- HTTP方法：POST
- 验证请求头：{"X-GitHub-Event": "push"}
- 保存数据到变量：github_data

使用curl测试（请将端口号替换为实际配置的后端端口）：
curl -X POST http://localhost:YOUR_PORT/api/triggers/webhook/your_id \\
  -H "X-GitHub-Event: push" \\
  -d '{"repository": "test-repo", "commits": []}'
\`\`\`

### 安全建议
- 使用请求头验证增强安全性
- 使用查询参数作为密钥验证
- 在生产环境使用HTTPS
- 定期更换Webhook ID

---

## ⌨️ 热键触发器

### 功能说明
监听全局热键，按下指定组合键时触发工作流。

### 配置项
- **热键组合**：如 \`ctrl+shift+f1\`
- **超时时间**：等待时间（0=无限等待）

### 支持的按键
- **修饰键**：ctrl、alt、shift、win
- **功能键**：f1-f12
- **字母键**：a-z
- **组合方式**：用+连接，如 \`ctrl+alt+a\`

### 使用场景
- 快速启动工作流
- 需要人工确认的自动化
- 游戏辅助脚本
- 快捷操作触发

### 示例：快速截图
\`\`\`
配置：
- 热键组合：ctrl+shift+s
- 后续模块：截图 → 保存图片 → 系统通知

效果：按下Ctrl+Shift+S立即截图并保存
\`\`\`

### 注意事项
- 确保热键不与系统或其他应用冲突
- 热键监听是全局的，即使窗口不在前台也能触发
- 避免使用常用的系统快捷键

---

## 📁 文件监控触发器

### 功能说明
监控文件或文件夹的变化，检测到指定事件时触发工作流。

### 配置项
- **监控路径**：文件或文件夹路径
- **监控类型**：created（创建）、modified（修改）、deleted（删除）、any（任意）
- **文件名模式**：通配符匹配，如 \`*.txt\`、\`report_*.xlsx\`
- **超时时间**：等待时间（0=无限等待）
- **保存事件信息到变量**：事件数据保存的变量名

### 使用场景
- 自动处理新下载的文件
- 监控日志文件变化
- 文件同步和备份
- 自动导入数据文件

### 示例：自动处理下载文件
\`\`\`
配置：
- 监控路径：C:\\Users\\Downloads
- 监控类型：created
- 文件名模式：*.xlsx
- 保存到变量：file_event

后续流程：
1. 读取Excel文件（使用 {{file_event.filePath}}）
2. 数据处理
3. 发送邮件通知
\`\`\`

### 通配符说明
- \`*\`：匹配任意字符
- \`?\`：匹配单个字符
- \`*.txt\`：所有txt文件
- \`report_*.xlsx\`：以report_开头的Excel文件

---

## 📧 邮件触发器

### 功能说明
监控邮箱，收到符合条件的新邮件时触发工作流。

### 配置项
- **邮件服务器**：IMAP服务器地址
- **端口**：IMAP端口（通常为993）
- **邮箱账号**：登录账号
- **邮箱密码/授权码**：登录密码或授权码
- **发件人过滤**：可选，只触发指定发件人的邮件
- **主题关键词过滤**：可选，只触发包含关键词的邮件
- **检查间隔**：每隔多少秒检查一次（建议≥30秒）
- **超时时间**：等待时间（0=无限等待）
- **保存邮件信息到变量**：邮件数据保存的变量名

### 常用邮箱配置
| 邮箱 | IMAP服务器 | 端口 | 说明 |
|------|-----------|------|------|
| QQ邮箱 | imap.qq.com | 993 | 需要授权码 |
| 163邮箱 | imap.163.com | 993 | 需要授权码 |
| Gmail | imap.gmail.com | 993 | 需要应用专用密码 |
| Outlook | outlook.office365.com | 993 | 使用登录密码 |

### 使用场景
- 订单邮件自动处理
- 邮件通知触发工作流
- 自动回复邮件
- 邮件内容提取和分析

### 示例：订单邮件处理
\`\`\`
配置：
- 邮件服务器：imap.qq.com
- 端口：993
- 主题关键词过滤：订单通知
- 检查间隔：60秒
- 保存到变量：email_data

后续流程：
1. 正则提取订单号（从 {{email_data.body}}）
2. 查询数据库
3. 更新订单状态
4. 发送确认邮件
\`\`\`

### 获取授权码
**QQ邮箱**：
1. 登录QQ邮箱网页版
2. 设置 → 账户 → POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务
3. 开启IMAP服务
4. 生成授权码

**163邮箱**：
1. 登录163邮箱网页版
2. 设置 → POP3/SMTP/IMAP
3. 开启IMAP服务
4. 设置客户端授权密码

---

## 🔄 API触发器

### 功能说明
定期轮询API接口，当响应满足指定条件时触发工作流。

### 配置项
- **API地址**：接口URL
- **HTTP方法**：GET或POST
- **请求头**：JSON格式的请求头
- **请求体**：JSON格式的请求体（仅POST）
- **条件判断路径**：JSONPath表达式，如 \`data.status\`
- **比较运算符**：==、!=、>、<、contains
- **期望的值**：条件判断的目标值
- **检查间隔**：每隔多少秒请求一次
- **超时时间**：等待时间（0=无限等待）
- **保存响应数据到变量**：响应数据保存的变量名

### 使用场景
- 等待异步任务完成
- 监控API状态变化
- 轮询查询结果
- 等待资源就绪

### 示例：等待任务完成
\`\`\`
配置：
- API地址：https://api.example.com/task/status
- HTTP方法：GET
- 请求头：{"Authorization": "Bearer token123"}
- 条件判断路径：data.status
- 比较运算符：==
- 期望的值：completed
- 检查间隔：10秒
- 保存到变量：task_result

流程说明：
1. 每10秒请求一次API
2. 检查 data.status 是否等于 "completed"
3. 满足条件后继续执行后续流程
\`\`\`

### JSONPath示例
- \`data.status\`：访问 \`{"data": {"status": "completed"}}\`
- \`result[0].name\`：访问数组第一个元素的name字段
- \`$.items.length\`：获取items数组的长度

### 条件运算符说明
- **==**：等于（精确匹配）
- **!=**：不等于
- **>**：大于（数值比较）
- **<**：小于（数值比较）
- **contains**：包含（字符串包含）

---

## 🖱️ 鼠标触发器

### 功能说明
监听全局鼠标事件，检测到指定鼠标操作时触发工作流。

### 配置项
- **触发类型**：
  - 鼠标左键点击
  - 鼠标右键点击
  - 鼠标中键点击
  - 向上滚动
  - 向下滚动
  - 移动超过指定距离
- **移动距离阈值**：仅移动类型有效，单位像素
- **超时时间**：等待时间（0=无限等待）
- **保存到变量**：保存鼠标位置和事件信息

### 使用场景
- 鼠标手势识别
- 快捷操作触发
- 游戏辅助脚本
- 鼠标行为监控

### 示例：右键快捷菜单
\`\`\`
配置：
- 触发类型：鼠标右键点击
- 保存到变量：mouse_position

后续流程：
1. 获取鼠标位置（{{mouse_position.x}}, {{mouse_position.y}}）
2. 显示自定义菜单
3. 执行对应操作
\`\`\`

### 注意事项
- 鼠标监听是全局的，会捕获所有鼠标事件
- 移动触发建议设置合理的距离阈值
- 避免与系统鼠标操作冲突

---

## 🖼️ 图像触发器

### 功能说明
持续检测屏幕上是否出现指定图像，检测到后立即触发工作流。

### 配置项
- **图像路径**：要检测的图像文件路径（PNG、JPG等）
- **匹配置信度**：0.5-1.0，值越高匹配越精确（建议0.7-0.9）
- **检查间隔**：每隔多少秒检查一次屏幕
- **超时时间**：等待时间（0=无限等待）
- **限定搜索区域**：可选，限定屏幕区域提高识别速度
- **保存到变量**：保存图像位置和匹配度

### 使用场景
- 等待界面加载完成
- 等待按钮出现
- 游戏自动化
- UI自动化测试

### 示例：等待登录按钮
\`\`\`
配置：
- 图像路径：C:\\images\\login_button.png
- 匹配置信度：0.8
- 检查间隔：0.5秒
- 保存到变量：button_position

后续流程：
1. 检测到登录按钮后
2. 点击按钮位置（{{button_position.x}}, {{button_position.y}}）
3. 继续登录流程
\`\`\`

### 优化建议
- 使用清晰的截图作为模板
- 限定搜索区域提高性能
- 调整置信度避免误匹配
- 检查间隔不宜过短

---

## 🔊 声音触发器

### 功能说明
监听系统音频输出（扬声器），当音量达到阈值时触发工作流。

### 配置项
- **音量阈值**：0-100%，达到此音量时触发
- **检查间隔**：每隔多少秒检查一次音量
- **超时时间**：等待时间（0=无限等待）
- **保存到变量**：保存触发时的音量值

### 使用场景
- 检测通知声音
- 检测提示音
- 音频事件监控
- 声音报警触发

### 示例：检测系统通知音
\`\`\`
配置：
- 音量阈值：30%
- 检查间隔：0.1秒
- 保存到变量：sound_volume

后续流程：
1. 检测到声音后
2. 截图保存
3. 记录日志
\`\`\`

### 注意事项
- 监听的是系统音频输出，不是麦克风
- 音量阈值根据实际情况调整
- 检查间隔过短可能影响性能
- 需要系统音频权限

---

## 👤 人脸触发器

### 功能说明
实时监控摄像头画面，检测到目标人脸时自动触发工作流。

### 配置项
- **目标人脸图片**：用于比对的目标人脸照片路径
- **匹配容差**：0.3-0.8，越小越严格（建议0.4-0.6，默认0.6）
- **摄像头索引**：0为默认摄像头，多个摄像头可尝试1、2等
- **检查间隔**：每隔多少秒检查一次摄像头画面
- **超时时间**：等待时间（0=无限等待）
- **保存到变量**：保存识别结果（匹配度、人脸位置等）

### 使用场景
- 人脸考勤系统
- 身份验证触发
- 安全监控
- 智能门禁

### 示例：人脸考勤
\`\`\`
配置：
- 目标人脸图片：C:\\faces\\employee_001.jpg
- 匹配容差：0.5
- 摄像头索引：0
- 检查间隔：0.5秒
- 保存到变量：face_detected

后续流程：
1. 检测到目标人脸后
2. 记录考勤时间
3. 保存考勤照片
4. 发送通知
\`\`\`

### 注意事项
- 确保摄像头已正确连接并授权
- 目标人脸图片应清晰且只包含一张人脸
- 光线条件会影响识别准确度
- 匹配容差需要根据实际情况调整
- 检查间隔不宜过短，避免性能问题

---

## 🔄 子元素变化触发器

### 功能说明
监控网页元素的子元素数量变化，实时检测新增内容，适用于直播评论、聊天消息、动态列表等场景。

### 配置项
- **元素选择器**：要监控的父元素CSS选择器
- **检查间隔**：每隔多少秒检查一次（建议0.5-2秒）
- **超时时间**：等待时间（0=无限等待）
- **保存新增元素选择器到变量**：保存新增元素的CSS选择器
- **保存变化信息到变量**：保存变化详情（变化类型、数量等）

### 使用场景
- 监控直播间评论
- 监控聊天消息
- 监控动态列表更新
- 监控实时数据变化
- 监控新闻推送

### 示例：监控直播评论
\`\`\`
配置：
- 元素选择器：.comment-list
- 检查间隔：1秒
- 保存新增元素选择器到：new_comment_selector
- 保存变化信息到：change_info

后续流程：
1. 检测到新评论后
2. 提取评论内容（使用 {{new_comment_selector}}）
3. 分析评论关键词
4. 自动回复或记录
\`\`\`

### 变化信息说明
保存的变化信息包含：
- **changeType**：变化类型（increased/decreased）
- **previousCount**：变化前的子元素数量
- **currentCount**：变化后的子元素数量
- **changeCount**：变化的数量
- **timestamp**：变化发生的时间
- **checkCount**：检查次数

### 新增元素选择器
当检测到子元素增加时，会自动生成最新新增元素的CSS选择器，优先级：
1. 使用元素ID（如果有）
2. 使用元素class
3. 使用nth-child伪类

### 注意事项
- 需要先打开网页才能使用
- 元素选择器必须准确
- 检查间隔不宜过短，避免性能问题
- 适用于动态加载的内容
- 只监控直接子元素的数量变化

### 优化建议
- 使用精确的CSS选择器
- 根据网页更新频率调整检查间隔
- 结合条件判断过滤无效变化
- 使用循环处理多个新增元素

---

## 💡 最佳实践

### 1. 触发器组合使用
可以在一个工作流中使用多个触发器，实现复杂的触发逻辑：
- 文件监控 + 邮件通知
- API轮询 + Webhook回调
- 定时触发 + 条件判断

### 2. 错误处理
建议在触发器后添加错误处理：
\`\`\`
触发器 → 条件判断 → 正常流程
              ↓
           错误处理 → 日志记录 → 通知
\`\`\`

### 3. 超时设置
- 开发测试时设置较短的超时时间
- 生产环境根据实际需求设置
- 长时间运行的触发器建议设置超时

### 4. 资源管理
- 避免过于频繁的轮询（API触发器、邮件触发器）
- 文件监控避免监控大量文件
- 定时触发器注意设置合理的间隔

### 5. 安全考虑
- Webhook使用验证机制
- 邮箱密码使用授权码
- API请求使用Token认证
- 敏感信息使用变量存储

### 6. 调试技巧
- 使用打印日志模块记录触发信息
- 先用较短的超时时间测试
- 检查变量内容是否符合预期
- 使用条件判断验证触发条件

---

## 🔧 故障排查

### Webhook触发器
**问题**：Webhook无法触发
- 检查URL是否正确
- 检查HTTP方法是否匹配
- 检查验证条件是否正确
- 使用curl测试Webhook

### 热键触发器
**问题**：热键无响应
- 检查热键格式是否正确
- 确认热键未被其他程序占用
- 检查是否有权限监听全局热键

### 文件监控触发器
**问题**：文件变化未触发
- 检查路径是否存在
- 检查文件名模式是否正确
- 确认监控类型是否匹配
- 检查文件系统权限

### 邮件触发器
**问题**：无法连接邮箱
- 检查IMAP服务是否开启
- 确认使用授权码而非登录密码
- 检查服务器地址和端口
- 检查网络连接

### API触发器
**问题**：条件一直不满足
- 检查API地址是否正确
- 验证JSONPath表达式
- 检查条件运算符和期望值
- 使用Postman测试API响应

### 鼠标/图像/声音/人脸触发器
**问题**：触发器无响应
- 检查系统权限设置
- 确认相关库已正确安装
- 检查配置参数是否合理
- 查看日志了解详细错误信息

### 子元素变化触发器
**问题**：无法检测到变化
- 检查元素选择器是否正确
- 确认已打开目标网页
- 检查元素是否为动态加载
- 调整检查间隔时间
- 使用浏览器开发者工具验证选择器

---

## 📚 相关文档

- [基础模块](basic-modules)：了解基础模块使用
- [流程控制](advanced-features)：条件判断和循环
- [变量系统](variables-guide)：变量的使用和管理
- [调试指南](debug-guide)：工作流调试技巧
- [实战案例](practical-cases)：触发器实战示例

---

## 🎯 总结

触发器是实现自动化的关键，选择合适的触发器可以让工作流真正"自动"运行：

- **Webhook触发器**：适合接收外部通知
- **热键触发器**：适合快速启动和人工确认
- **文件监控触发器**：适合文件自动处理
- **邮件触发器**：适合邮件驱动的自动化
- **API触发器**：适合等待异步任务
- **鼠标触发器**：适合鼠标手势和快捷操作
- **图像触发器**：适合等待界面元素出现
- **声音触发器**：适合音频事件监控
- **人脸触发器**：适合人脸识别和身份验证
- **子元素变化触发器**：适合监控网页元素变化（如直播评论、聊天消息等）

合理使用触发器，可以构建强大的自动化系统！
`
